<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FoxitPDFSDKforWeb: /builds/foxit/phantom/cloud/phantompdf_online/foxitwebsdk/doxygen/workspace/headerfiles/uix-addons/thumbnail/thumbUIComponent.js</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="favicon.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FoxitPDFSDKforWeb
   &#160;<span id="projectnumber">v10.0.0</span>
   </div>
   <div id="projectbrief">Foxit PDF SDK for Web</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_2builds_2foxit_2phantom_2cloud_2phantompdf_online_2foxitwebsdk_2doxygen_2workspace_2headerfiles41e10562a7f3176edd6b5dfa9e895266.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/builds/foxit/phantom/cloud/phantompdf_online/foxitwebsdk/doxygen/workspace/headerfiles/uix-addons/thumbnail/thumbUIComponent.js</div>  </div>
</div><!--header-->
<div class="contents">
<p>// from <code>1</code> to <code>pageCount</code> { pages: [1,2,3,5,6,8], pagesGroup: [[1,2,3], [5,6], [8]], pageRangeGroup: [[1,3], [5,6], [8]], pageRangeStrings: ["1-3", "5-6", "8"], pageRangeString: "1-3, 5-6, 8", isSelected: true }</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> CompilePannelTemplate from <span class="stringliteral">&quot;./templates/thumb.art&quot;</span>;</div><div class="line"><span class="keyword">import</span> compileThumbTemplate from <span class="stringliteral">&quot;./templates/thumb-item.art&quot;</span>;</div><div class="line"><span class="keyword">import</span> * as UIExtension from <span class="stringliteral">&quot;UIExtension&quot;</span>;</div><div class="line"><span class="keyword">import</span> _debounce from <span class="stringliteral">&quot;lodash/debounce&quot;</span>;</div><div class="line"><span class="keyword">const</span> __ = UIExtension.__;</div><div class="line"><span class="keyword">const</span> $ = UIExtension.vendors.jQuery;</div><div class="line"><span class="keyword">const</span> <a class="code" href="group___u_i_consts.html#ga8d49eee702ea8df863443a7c06c66192">COMPONENT_EVENTS</a> = UIExtension.UIConsts.COMPONENT_EVENTS;</div><div class="line"><span class="keyword">const</span> PDFDocPermission = UIExtension.PDFViewCtrl.Consts.PDFDocPermission;</div><div class="line"><span class="keyword">const</span> Events = UIExtension.PDFViewCtrl.ViewerEvents;</div><div class="line"><span class="keyword">const</span> <a class="code" href="group___u_i_extension.html#ga6a3ae6ca8238b9e9707c675968e61dd1">UIEvents</a> = UIExtension.UIEvents;</div><div class="line"><span class="keyword">import</span> <span class="stringliteral">&quot;./style/thumb.scss&quot;</span>;</div><div class="line"><span class="keyword">import</span> Dragable from <span class="stringliteral">&#39;../../src/shared/Dragable.js&#39;</span>;</div><div class="line"><span class="keyword">import</span> { htmlCharacter2Entity } from <span class="stringliteral">&quot;../../src/shared/html-util&quot;</span>;</div><div class="line"><span class="keyword">import</span> DragFileInsert from <span class="stringliteral">&#39;./dragFileInsert&#39;</span>;</div><div class="line"><span class="keyword">import</span> {</div><div class="line">    THUMBNAIL_PAGE_BASIS_WIDTH,</div><div class="line">    THUMBNAIL_PAGE_BASIS_HEIGHT,</div><div class="line">    adjustContainerFlexBox,</div><div class="line">    resetContainerStyle,</div><div class="line">    resetScale,</div><div class="line">    showScaleContextmenu</div><div class="line">} from <span class="stringliteral">&quot;./contextmenu/thumbScale&quot;</span>;</div><div class="line"><span class="keyword">import</span> { isPageLabelSetting } from <span class="stringliteral">&quot;../../src/shared/feature-common/formatPageLabel&quot;</span>;</div><div class="line"><span class="keyword">import</span> { ThumbnailZoomService } from <span class="stringliteral">&#39;./zoom/ThumbnailZoomService&#39;</span>;</div><div class="line"><span class="keyword">import</span> { DebounceAsyncTaskExecutor } from <span class="stringliteral">&#39;./core&#39;</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> THUMB_BORDER_WIDTH = 1;</div><div class="line"><span class="keyword">const</span> RECT_BORDER_WIDTH = 2;</div><div class="line"></div><div class="line"><span class="keyword">const</span> {</div><div class="line">    PDFViewCtrl: {</div><div class="line">        BrowserInfo: { isSafari },</div><div class="line">        DeviceInfo: {</div><div class="line">            isTouchDevice, <a name="a0"></a><a class="code" href="group___device_info.html#ga3acdbc499923bf65dcc6039f9ebd9463">isDesktop</a>, isMacOS</div><div class="line">        },</div><div class="line">        shared: {</div><div class="line">            attachContextMenuEvent</div><div class="line">        }</div><div class="line">    }</div><div class="line">} = UIExtension;</div><div class="line"></div><div class="line">export <span class="keywordflow">default</span> <span class="keyword">class </span>ThumbUIComponent <span class="keyword">extends</span> UIExtension.components</div><div class="line">    .<a name="_a1"></a><a class="code" href="class_container_component.html">ContainerComponent</a> {</div><div class="line">    <span class="keyword">static</span> <a name="a2"></a><a class="code" href="class_component.html#a8d4b7e48c03fa768e280c2bdb58c1b2b">getName</a>() {</div><div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;thumbnail-panel&quot;</span>;</div><div class="line">    }</div><div class="line">    <span class="keyword">static</span> inject() {</div><div class="line">        <span class="keywordflow">return</span> {</div><div class="line">            zoomService: ThumbnailZoomService,</div><div class="line">        };</div><div class="line">    }</div><div class="line"></div><div class="line">    constructor(...props) {</div><div class="line">        super(...props);</div><div class="line"></div><div class="line">        <span class="comment">// Control the frequency of thumbnail updates.</span></div><div class="line">        this.updateVisiblePages = _debounce(this.updateVisiblePages.bind(<span class="keyword">this</span>), 100);</div><div class="line"></div><div class="line">        this.evTnRectDown = null;</div><div class="line">        this.evDocMove = null;</div><div class="line">        this.evDocUp = null;</div><div class="line">        this.moving = <span class="keyword">false</span>; <span class="comment">// 红框是否处于移动状态</span></div><div class="line">        this.resizing = <span class="keyword">false</span>; <span class="comment">// 红框是否处于调整状态</span></div><div class="line"></div><div class="line">        this.cachePageIndex = -1;</div><div class="line">        this.prevPos = {x: 0, y: 0};</div><div class="line">    }</div><div class="line">    allInjected() {</div><div class="line">        <span class="keyword">const</span> executor = <span class="keyword">new</span> DebounceAsyncTaskExecutor()</div><div class="line">        this.<a name="a3"></a><a class="code" href="class_component.html#a980cf1c65fa4f6673b0bd81a5ff8788d">addDestroyHook</a>(</div><div class="line">            this.zoomService.onScaleChanged((scaleRatio, isMin, isMax, isSmall) =&gt; {</div><div class="line">                executor.exec(() =&gt; {</div><div class="line">                    return this.getPDFUI().getPDFViewer().then(pdfViewer =&gt; {</div><div class="line">                        if(!pdfViewer.getCurrentPDFDoc()) {</div><div class="line">                            return;</div><div class="line">                        }</div><div class="line">                        return this._updateOnScaleChanged(scaleRatio, isSmall);</div><div class="line">                    });</div><div class="line">                });</div><div class="line">            }),</div><div class="line">            () =&gt; executor.cancel()</div><div class="line">        )</div><div class="line">    }</div><div class="line">    _updateOnScaleChanged(scaleRatio, isSmall) {</div><div class="line">        <span class="keyword">const</span> { $thumbImageContainer, $thumbImageContainerBox} = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">const</span> thumbImageContainerBox = $thumbImageContainerBox.get(0);</div><div class="line">        <span class="keyword">const</span> thumbImageContainer = $thumbImageContainer.get(0);</div><div class="line"></div><div class="line">        thumbImageContainer.classList.toggle(<span class="stringliteral">&#39;small-size&#39;</span>, isSmall);</div><div class="line"></div><div class="line">        <span class="keyword">const</span> pageWidth = THUMBNAIL_PAGE_BASIS_WIDTH * scaleRatio;</div><div class="line">        <span class="keyword">const</span> pageHeight = THUMBNAIL_PAGE_BASIS_HEIGHT * scaleRatio;</div><div class="line">        <span class="keyword">const</span> pages = thumbImageContainer.querySelectorAll(<span class="stringliteral">&#39;.fv__thumb-page&#39;</span>);</div><div class="line">        pages.forEach(el =&gt; {</div><div class="line">            el.style.cssText += `</div><div class="line">                width: ${pageWidth}px;</div><div class="line">                height: ${pageHeight}px</div><div class="line">            `;</div><div class="line">        });</div><div class="line">        <span class="keyword">const</span> containerBoxWidth = thumbImageContainerBox.getBoundingClientRect().width;</div><div class="line">        <span class="keyword">const</span> containerWidth = thumbImageContainer.getBoundingClientRect().width;</div><div class="line">        <span class="comment">// reduce triggered, reduce the container&#39;s width if container more than outer box&#39;s width</span></div><div class="line">        <span class="keywordflow">if</span> (pageWidth &lt; containerWidth &amp;&amp; containerWidth &gt; containerBoxWidth) {</div><div class="line">            $thumbImageContainer.css({ width: Math.max(pageWidth, containerBoxWidth) });</div><div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (containerWidth &lt; pageWidth) {</div><div class="line">            <span class="comment">// enlarge triggered, enlarge the container&#39;s width if container less than page&#39;s width</span></div><div class="line">            $thumbImageContainer.css({ width: pageWidth });</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            $thumbImageContainer.css({ width: <span class="stringliteral">&#39;auto&#39;</span> });</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span> this.updateVisiblePages();</div><div class="line">    }</div><div class="line">    createDOMElement() {</div><div class="line">        <span class="keywordflow">return</span> document.createElement(<span class="stringliteral">&quot;div&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    <a name="a4"></a><a class="code" href="class_container_component.html#a16fa3b409645fc3fdd075bdff4d1b2c7">getContainerElement</a>() {</div><div class="line">        <span class="keywordflow">return</span> this.$html.find(<span class="stringliteral">&quot;.fv__thumb-image-container&quot;</span>)[0];</div><div class="line">    }</div><div class="line"></div><div class="line">    <a name="a5"></a><a class="code" href="class_component.html#afcdc542cef79f2418bf6cd23370210fa">render</a>() {</div><div class="line">        super.render();</div><div class="line">        this.element.classList.add(<span class="stringliteral">&#39;fv__ui-thumbnail-panel-body&#39;</span>);</div><div class="line">        let $element = $(this.<a name="a6"></a><a class="code" href="class_component.html#ab17f094a9fe3c0510aa9f0c2937eac75">element</a>);</div><div class="line">        $element[0].innerHTML = CompilePannelTemplate();</div><div class="line"></div><div class="line">        this.$thumbImageContainerBox = $element.find(</div><div class="line">            <span class="stringliteral">&quot;.fv__thumb-image-container-box&quot;</span></div><div class="line">        );</div><div class="line">        this.$thumbImageContainer = $element.find(<span class="stringliteral">&quot;.fv__thumb-image-container&quot;</span>);</div><div class="line"></div><div class="line">        this.$html = $element;</div><div class="line">    }</div><div class="line"></div><div class="line">    mounted() {</div><div class="line">        super.mounted();</div><div class="line"></div><div class="line">        <span class="comment">// 右键菜单开关</span></div><div class="line">        <span class="keyword">const</span> isCollaborationMode = this.pdfUI.customs &amp;&amp; this.pdfUI.customs.isCollaborationMode();</div><div class="line">        this.contextmenuSwitch = isCollaborationMode ? <span class="stringliteral">&#39;off&#39;</span> : <span class="stringliteral">&#39;on&#39;</span>;</div><div class="line"></div><div class="line">        this.$thumbImageContainerBox.scroll(e =&gt; {</div><div class="line">            this.updateVisiblePages();</div><div class="line">        });</div><div class="line"></div><div class="line">        this.addDragEvent();</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (</div><div class="line">            navigator &amp;&amp;</div><div class="line">            navigator.userAgent &amp;&amp;</div><div class="line">            navigator.userAgent.indexOf(<span class="stringliteral">&quot;Firefox&quot;</span>) &gt; -1</div><div class="line">        ) {</div><div class="line">            this.element.addEventListener(<span class="stringliteral">&quot;drop&quot;</span>, e =&gt; {</div><div class="line">                e.preventDefault();</div><div class="line">                e.stopPropagation();</div><div class="line">            });</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">const</span> modifyPermission = UIExtension.PDFViewCtrl.Consts.PDFDocPermission.ModifyDocument;</div><div class="line">        <span class="keyword">const</span> contextmenu = this.<a name="a7"></a><a class="code" href="class_component.html#afab378d36400162e7a759793cf6e466f">getRoot</a>().getComponentByName(<span class="stringliteral">&quot;fv--thumbnail-contextmenu&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> (contextmenu) {</div><div class="line">            <span class="keyword">const</span> assemblePermission = modifyPermission + UIExtension.PDFViewCtrl.Consts.PDFDocPermission.Assemble;</div><div class="line">            <span class="keyword">const</span> contextMenuItemCopy = contextmenu.getComponentByName(<span class="stringliteral">&quot;contextmenu-item-thumbnail-copy&quot;</span>);</div><div class="line">            <span class="keyword">const</span> contextMenuItemPaste = contextmenu.getComponentByName(<span class="stringliteral">&quot;contextmenu-item-thumbnail-paste&quot;</span>);</div><div class="line">            <span class="keyword">const</span> contextMenuItemDelete = contextmenu.getComponentByName(<span class="stringliteral">&quot;contextmenu-item-thumbnail-delete&quot;</span>);</div><div class="line">            <span class="keyword">const</span> contextMenuPageReverse = contextmenu.getComponentByName(<span class="stringliteral">&quot;organize-tab-page-reverse&quot;</span>);</div><div class="line">            <span class="keyword">const</span> contextMenuItemExtract = contextmenu.getComponentByName(<span class="stringliteral">&quot;contextmenu-item-thumbnail-extract&quot;</span>);</div><div class="line">            <span class="keyword">const</span> contextMenuItemSplit = contextmenu.getComponentByName(<span class="stringliteral">&quot;contextmenu-item-thumbnail-split&quot;</span>);</div><div class="line">            <span class="keyword">const</span> contextMenuItemRotate = contextmenu.getComponentByName(<span class="stringliteral">&quot;contextmenu-item-thumbnail-rotate&quot;</span>);</div><div class="line">            <span class="keyword">const</span> contextMenuItemRotateLeft = contextmenu.getComponentByName(<span class="stringliteral">&quot;contextmenu-item-thumbnail-rotate-left&quot;</span>);</div><div class="line">            <span class="keyword">const</span> contextMenuItemRotateRight = contextmenu.getComponentByName(<span class="stringliteral">&quot;contextmenu-item-thumbnail-rotate-right&quot;</span>);</div><div class="line">            <span class="keyword">const</span> contextmenuItemThumbnailMove = contextmenu.getComponentByName(<span class="stringliteral">&#39;contextmenu-item-thumbnail-move&#39;</span>);</div><div class="line">            <span class="keyword">const</span> contextMenuItemEnlarge = contextmenu.getComponentByName(<span class="stringliteral">&#39;contextmenu-item-thumbnail-enlarge&#39;</span>);</div><div class="line">            <span class="keyword">const</span> contextMenuItemReduce = contextmenu.getComponentByName(<span class="stringliteral">&#39;contextmenu-item-thumbnail-reduce&#39;</span>);</div><div class="line">            <span class="comment">// 获取swap pages 右键菜单</span></div><div class="line">            <span class="keyword">const</span> contextmenuItemThumbnailSwap = contextmenu.getComponentByName(<span class="stringliteral">&#39;contextmenu-item-thumbnail-swap&#39;</span>);</div><div class="line">            <span class="comment">// 获取replace pages 右键菜单</span></div><div class="line">            <span class="keyword">const</span> contextmenuItemThumbnailReplace = contextmenu.getComponentByName(<span class="stringliteral">&#39;contextmenu-item-thumbnail-replace&#39;</span>);</div><div class="line">            <span class="keyword">const</span> contextmenuItemThumbnailCrop = contextmenu.getComponentByName(<span class="stringliteral">&#39;contextmenu-item-thumbnail-crop&#39;</span>);</div><div class="line">            <span class="keyword">const</span> contextmenuItemThumbnailDuplicate = contextmenu.getComponentByName(<span class="stringliteral">&#39;contextmenu-item-thumbnail-duplicate&#39;</span>);</div><div class="line">            <span class="keyword">const</span> contextmenuItemEmbed = contextmenu.getComponentByName(<span class="stringliteral">&#39;contextmenu-item-thumbnail-embed&#39;</span>);</div><div class="line">            <span class="keyword">const</span> contextmenuItemRemoveEmbedded = contextmenu.getComponentByName(<span class="stringliteral">&#39;contextmenu-item-thumbnail-remove-embedded&#39;</span>);</div><div class="line">            <span class="keyword">const</span> contextmenuItemFormatNumbering = contextmenu.getComponentByName(<span class="stringliteral">&#39;contextmenu-item-thumbnail-format-numbering&#39;</span>);</div><div class="line">                        <span class="keyword">const</span> contextmenuItemSepReversePage = contextmenu.getComponentByName(<span class="stringliteral">&#39;contextmenu-item-sep-reverse-page&#39;</span>);</div><div class="line">            <span class="keyword">const</span> contextmenuItemAddBlankPage = contextmenu.getComponentByName(<span class="stringliteral">&#39;contextmenu-item-thumbnail-add-blank-page&#39;</span>);</div><div class="line">            <span class="keyword">const</span> contextmenuItemPageTransitions = contextmenu.getComponentByName(<span class="stringliteral">&#39;contextmenu-item-thumbnail-pageTransitions&#39;</span>);</div><div class="line">            <span class="keyword">const</span> pageProperties = contextmenu.getComponentByName(<span class="stringliteral">&#39;contextmenu-item-thumbnail-properties&#39;</span>);</div><div class="line">            <span class="keyword">const</span> contextmenuOffHandle = contextmenu.on(<a class="code" href="group___u_i_consts.html#ga8d49eee702ea8df863443a7c06c66192">COMPONENT_EVENTS</a>.SHOWN, () =&gt; {</div><div class="line">                if (this.pdfUI.pdfViewer.currentPDFDoc.viewAutoScrolling) {</div><div class="line">                    contextmenu.disable();</div><div class="line">                    return;</div><div class="line">                }</div><div class="line">                contextmenu.enable();</div><div class="line">                this.<a name="a8"></a><a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>()</div><div class="line">                    .<a name="a9"></a><a class="code" href="class_p_d_f_viewer.html#a6f6e9b9bc0c421f649317010b3faf00e">getPDFDocRender</a>()</div><div class="line">                    .then(docRender =&gt; {</div><div class="line">                        <span class="keyword">const</span> permission = docRender.getUserPermission().getValue();</div><div class="line">                        <span class="keyword">const</span> isXFA = docRender.doc.isXFA();</div><div class="line">                        <span class="keyword">const</span> contextmenuItemInsertPage = document.querySelector(<span class="stringliteral">&#39;#contextmenu-item-insert-page&#39;</span>);</div><div class="line">                        <span class="keywordflow">if</span> (permission &amp; modifyPermission) {</div><div class="line">                            contextMenuItemCopy &amp;&amp; contextMenuItemCopy.enable();</div><div class="line">                            contextMenuItemPaste &amp;&amp; contextMenuItemPaste.enable();</div><div class="line">                            contextMenuPageReverse &amp;&amp; contextMenuPageReverse.enable();</div><div class="line">                            contextMenuItemExtract &amp;&amp; contextMenuItemExtract.enable();</div><div class="line">                            contextMenuItemSplit &amp;&amp; contextMenuItemSplit.enable();</div><div class="line">                            contextmenuItemThumbnailMove &amp;&amp; contextmenuItemThumbnailMove.enable();</div><div class="line">                            contextmenuItemThumbnailSwap &amp;&amp; contextmenuItemThumbnailSwap.enable();</div><div class="line">                            contextmenuItemThumbnailCrop &amp;&amp; contextmenuItemThumbnailCrop.enable();</div><div class="line">                            contextmenuItemThumbnailDuplicate &amp;&amp; contextmenuItemThumbnailDuplicate.enable();</div><div class="line">                            contextmenuItemThumbnailReplace &amp;&amp; contextmenuItemThumbnailReplace.enable();</div><div class="line">                            contextmenuItemEmbed &amp;&amp; contextmenuItemEmbed.enable();</div><div class="line">                            contextmenuItemRemoveEmbedded &amp;&amp; contextmenuItemRemoveEmbedded.enable();</div><div class="line">                            contextmenuItemFormatNumbering &amp;&amp; contextmenuItemFormatNumbering.enable();</div><div class="line">                            contextmenuItemInsertPage &amp;&amp; contextmenuItemInsertPage.classList.remove(<span class="stringliteral">&quot;disabled&quot;</span>);</div><div class="line">                            contextmenuItemPageTransitions &amp;&amp; contextmenuItemPageTransitions.enable();</div><div class="line">                            pageProperties &amp;&amp; pageProperties.enable();</div><div class="line">                            <span class="comment">// if clipboard not initialized, disabled paste</span></div><div class="line">                            <span class="keywordflow">if</span> (this.controller.recordPagesToClipboard) {</div><div class="line">                                contextMenuItemPaste &amp;&amp; contextMenuItemPaste.enable();</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                contextMenuItemPaste &amp;&amp; contextMenuItemPaste.disable();</div><div class="line">                            }</div><div class="line">                        } <span class="keywordflow">else</span> {</div><div class="line">                            contextMenuItemCopy &amp;&amp; contextMenuItemCopy.disable();</div><div class="line">                            contextMenuItemPaste &amp;&amp; contextMenuItemPaste.disable();</div><div class="line">                            contextMenuPageReverse &amp;&amp; contextMenuPageReverse.disable();</div><div class="line">                            contextMenuItemExtract &amp;&amp; contextMenuItemExtract.disable();</div><div class="line">                            contextMenuItemSplit &amp;&amp; contextMenuItemSplit.disable();</div><div class="line">                            contextmenuItemThumbnailMove &amp;&amp; contextmenuItemThumbnailMove.disable();</div><div class="line">                            contextmenuItemThumbnailSwap &amp;&amp; contextmenuItemThumbnailSwap.disable();</div><div class="line">                            contextmenuItemThumbnailCrop &amp;&amp; contextmenuItemThumbnailCrop.disable();</div><div class="line">                            contextmenuItemThumbnailDuplicate &amp;&amp; contextmenuItemThumbnailDuplicate.disable();</div><div class="line">                            contextmenuItemThumbnailReplace &amp;&amp; contextmenuItemThumbnailReplace.disable();</div><div class="line">                            contextmenuItemEmbed &amp;&amp; contextmenuItemEmbed.disable();</div><div class="line">                            contextmenuItemRemoveEmbedded &amp;&amp; contextmenuItemRemoveEmbedded.disable();</div><div class="line">                            contextmenuItemFormatNumbering &amp;&amp; contextmenuItemFormatNumbering.disable();</div><div class="line">                            contextmenuItemInsertPage &amp;&amp; contextmenuItemInsertPage.classList.add(<span class="stringliteral">&quot;disabled&quot;</span>);</div><div class="line">                            contextmenuItemPageTransitions &amp;&amp; contextmenuItemPageTransitions.disable();</div><div class="line">                            pageProperties &amp;&amp; pageProperties.disable();</div><div class="line">                        }</div><div class="line">                        <span class="comment">// 编辑权限</span></div><div class="line">                        <span class="keywordflow">if</span> (permission &amp; assemblePermission) {</div><div class="line">                            contextMenuItemDelete &amp;&amp; contextMenuItemDelete.enable();</div><div class="line">                            contextMenuItemRotate &amp;&amp; contextMenuItemRotate.enable();</div><div class="line">                            contextMenuItemRotateLeft &amp;&amp; contextMenuItemRotateLeft.enable();</div><div class="line">                            contextMenuItemRotateRight &amp;&amp; contextMenuItemRotateRight.enable();</div><div class="line">                            contextmenuItemAddBlankPage &amp;&amp; contextmenuItemAddBlankPage.enable();</div><div class="line">                        } <span class="keywordflow">else</span> {</div><div class="line">                            contextMenuItemDelete &amp;&amp; contextMenuItemDelete.disable();</div><div class="line">                            contextMenuItemRotate &amp;&amp; contextMenuItemRotate.disable();</div><div class="line">                            contextMenuItemRotateLeft &amp;&amp; contextMenuItemRotateLeft.disable();</div><div class="line">                            contextMenuItemRotateRight &amp;&amp; contextMenuItemRotateRight.disable();</div><div class="line">                            contextmenuItemAddBlankPage &amp;&amp; contextmenuItemAddBlankPage.disable();</div><div class="line">                        }</div><div class="line">                        <span class="keywordflow">if</span> (this.$pages.length &lt;= 1) {</div><div class="line">                            contextMenuItemDelete &amp;&amp; contextMenuItemDelete.disable();</div><div class="line">                            contextmenuItemThumbnailMove &amp;&amp; contextmenuItemThumbnailMove.disable();</div><div class="line">                            contextmenuItemThumbnailSwap &amp;&amp; contextmenuItemThumbnailSwap.disable();</div><div class="line">                        }</div><div class="line"></div><div class="line">                        <span class="comment">// isXFAa后面再考虑</span></div><div class="line">                        isXFA.then((res) =&gt; {</div><div class="line">                            <span class="keywordflow">if</span>(res) {</div><div class="line">                                contextMenuItemRotate &amp;&amp; contextMenuItemRotate.disable();</div><div class="line">                                contextMenuItemRotateLeft &amp;&amp; contextMenuItemRotateLeft.disable();</div><div class="line">                                contextMenuItemRotateRight &amp;&amp; contextMenuItemRotateRight.disable();</div><div class="line">                                contextMenuItemDelete &amp;&amp; contextMenuItemDelete.disable();</div><div class="line">                                contextmenuItemAddBlankPage &amp;&amp; contextmenuItemAddBlankPage.disable()</div><div class="line">                                contextmenuItemThumbnailMove &amp;&amp; contextmenuItemThumbnailMove.disable();</div><div class="line">                                contextmenuItemThumbnailSwap &amp;&amp; contextmenuItemThumbnailSwap.disable();</div><div class="line">                                contextMenuItemSplit &amp;&amp; contextMenuItemSplit.disable();</div><div class="line">                                contextmenuItemThumbnailCrop &amp;&amp; contextmenuItemThumbnailCrop.disable();</div><div class="line">                                contextmenuItemThumbnailDuplicate &amp;&amp; contextmenuItemThumbnailDuplicate.disable();</div><div class="line">                            }</div><div class="line">                        })</div><div class="line">                        <span class="keywordflow">if</span> (!this.checkAddonInstance(<span class="stringliteral">&#39;MovePagesUIXAddon&#39;</span>) || this.controller.isStaticXFA) {</div><div class="line">                            contextmenuItemThumbnailMove &amp;&amp; contextmenuItemThumbnailMove.disable();</div><div class="line">                        }</div><div class="line"></div><div class="line">                        <span class="keyword">const</span> isProtectedView = localStorage.getItem(<span class="stringliteral">&#39;SECURITY_PROTECTED_VIEW&#39;</span>) === <span class="stringliteral">&#39;all&#39;</span> ? <span class="keyword">true</span>:<span class="keyword">false</span>;</div><div class="line">                        <span class="keyword">const</span> arr = [contextMenuItemCopy,contextMenuItemPaste,contextMenuItemDelete,contextMenuItemExtract,contextMenuItemSplit,contextMenuItemRotate,contextMenuItemRotateLeft,contextMenuItemRotateRight,contextmenuItemThumbnailMove,contextmenuItemThumbnailSwap,contextmenuItemThumbnailReplace,contextmenuItemThumbnailCrop,contextmenuItemThumbnailDuplicate,contextmenuItemEmbed,contextmenuItemRemoveEmbedded,contextmenuItemFormatNumbering,contextMenuPageReverse, contextmenuItemAddBlankPage, contextmenuItemPageTransitions];</div><div class="line">                        <span class="keywordflow">if</span>(isProtectedView){</div><div class="line">                            arr.forEach(<a name="a10"></a><a class="code" href="group___annot_consts_p_d_f.html#ggaac98f72f459761f8f46c1c445abf35bdaca3cf2ca9e0e7f4e96f2bbc362b9353a">m</a>=&gt; <a class="code" href="group___annot_consts_p_d_f.html#ggaac98f72f459761f8f46c1c445abf35bdaca3cf2ca9e0e7f4e96f2bbc362b9353a">m</a> &amp;&amp; <a class="code" href="group___annot_consts_p_d_f.html#ggaac98f72f459761f8f46c1c445abf35bdaca3cf2ca9e0e7f4e96f2bbc362b9353a">m</a>.hide());</div><div class="line">                            contextmenuItemInsertPage &amp;&amp; (contextmenuItemInsertPage.style.display=<span class="stringliteral">&#39;none&#39;</span>);</div><div class="line">                            setTimeout(()=&gt;{</div><div class="line">                                contextMenuPageReverse &amp;&amp; contextMenuPageReverse.hide();</div><div class="line">                                contextmenuItemSepReversePage &amp;&amp; contextmenuItemSepReversePage.hide();</div><div class="line">                            })</div><div class="line">                        }<span class="keywordflow">else</span>{</div><div class="line">                            arr.forEach(<a class="code" href="group___annot_consts_p_d_f.html#ggaac98f72f459761f8f46c1c445abf35bdaca3cf2ca9e0e7f4e96f2bbc362b9353a">m</a>=&gt;<a class="code" href="group___annot_consts_p_d_f.html#ggaac98f72f459761f8f46c1c445abf35bdaca3cf2ca9e0e7f4e96f2bbc362b9353a">m</a> &amp;&amp; <a class="code" href="group___annot_consts_p_d_f.html#ggaac98f72f459761f8f46c1c445abf35bdaca3cf2ca9e0e7f4e96f2bbc362b9353a">m</a>.show());</div><div class="line">                            contextmenuItemInsertPage &amp;&amp; (contextmenuItemInsertPage.style.display=<span class="stringliteral">&#39;block&#39;</span>);</div><div class="line">                        }</div><div class="line"></div><div class="line">                        <span class="keywordflow">return</span> docRender.doc.getPasswordType();</div><div class="line">                    }).then(type =&gt; {</div><div class="line">                        <span class="comment">// type = 1 无密码 非拥有者</span></div><div class="line">                        <span class="comment">// type = 2 有密码 部分权限</span></div><div class="line">                        <span class="comment">// type = 3 拥有者</span></div><div class="line">                        this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>()</div><div class="line">                        .<a class="code" href="class_p_d_f_viewer.html#a6f6e9b9bc0c421f649317010b3faf00e">getPDFDocRender</a>()</div><div class="line">                        .then((docRender) =&gt; {</div><div class="line">                            <span class="keyword">const</span> permission = docRender.getUserPermission().getValue();</div><div class="line">                            <span class="keywordflow">if</span> (type === 1 &amp;&amp; permission &gt; 0) { <span class="comment">// 非拥有者</span></div><div class="line">                                contextMenuItemExtract &amp;&amp; contextMenuItemExtract.disable();</div><div class="line">                                contextMenuItemSplit &amp;&amp; contextMenuItemSplit.disable();</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                contextMenuItemExtract &amp;&amp; contextMenuItemExtract.enable();</div><div class="line">                                contextMenuItemSplit &amp;&amp; contextMenuItemSplit.enable();</div><div class="line">                            }</div><div class="line">                        })</div><div class="line">                    })</div><div class="line">            });</div><div class="line">            this.<a class="code" href="class_component.html#a980cf1c65fa4f6673b0bd81a5ff8788d">addDestroyHook</a>(contextmenuOffHandle);</div><div class="line">            this.<a class="code" href="class_component.html#a980cf1c65fa4f6673b0bd81a5ff8788d">addDestroyHook</a>(() =&gt; {</div><div class="line">                this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().<a name="a11"></a><a class="code" href="class_p_d_f_u_i.html#a47cac244ba0f5f3f18a4bdfe3554f69b">addViewerEventListener</a>(<span class="stringliteral">&#39;permission-changed&#39;</span>, pdfDoc =&gt; contextmenuOffHandle);</div><div class="line">            });</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">const</span> detachContextmenu = attachContextMenuEvent(</div><div class="line">            this.element,</div><div class="line">            e =&gt; {</div><div class="line">                <span class="keyword">const</span> ePageThumb = e.target.closest(<span class="stringliteral">&quot;[data-page-index]&quot;</span>);</div><div class="line">                <span class="keywordflow">if</span> (!ePageThumb) {</div><div class="line">                    <span class="comment">// trigger contextmenu event, not on the page, show the scale contextmenu</span></div><div class="line">                    <span class="keywordflow">if</span> (showScaleContextmenu(this.<a class="code" href="class_component.html#afab378d36400162e7a759793cf6e466f">getRoot</a>(), e)) {</div><div class="line">                        e.preventDefault();</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keyword">const</span> pageIndex = +ePageThumb.getAttribute(<span class="stringliteral">&quot;data-page-index&quot;</span>);</div><div class="line">                <span class="keyword">const</span> contextmenu = this.<a class="code" href="class_component.html#afab378d36400162e7a759793cf6e466f">getRoot</a>().getComponentByName(</div><div class="line">                    <span class="stringliteral">&quot;fv--thumbnail-contextmenu&quot;</span></div><div class="line">                );</div><div class="line">                <span class="keywordflow">if</span>(this.contextmenuSwitch === <span class="stringliteral">&#39;off&#39;</span> || !contextmenu){<span class="keywordflow">return</span>}</div><div class="line"></div><div class="line">                contextmenu.setCurrentTarget(pageIndex);</div><div class="line">                contextmenu.showAt(e.clientX, e.clientY);</div><div class="line">                e.preventDefault();</div><div class="line">            },</div><div class="line">            <span class="keyword">true</span>, <span class="comment">// addEventListener 方法参数</span></div><div class="line">            (!<a class="code" href="group___device_info.html#ga3acdbc499923bf65dcc6039f9ebd9463">isDesktop</a> &amp;&amp; isTouchDevice) <span class="comment">// 使用兼容方案（sortable阻止了contextmenu事件触发）</span></div><div class="line">        );</div><div class="line"></div><div class="line">        this.<a class="code" href="class_component.html#a980cf1c65fa4f6673b0bd81a5ff8788d">addDestroyHook</a>(detachContextmenu);</div><div class="line">        <span class="comment">// 监听鼠标左右键和ctrl组合</span></div><div class="line">        this.$thumbImageContainerBox.on(<span class="stringliteral">&quot;mouseup&quot;</span>, <span class="stringliteral">&quot;.fv__thumb-page&quot;</span>, e =&gt; {</div><div class="line">            <span class="keywordflow">if</span> (e.button !== 0 &amp;&amp; e.button !== 2) { <span class="comment">// 只处理鼠标左右键</span></div><div class="line">                return;</div><div class="line">            }</div><div class="line">            <span class="keyword">const</span> cnt = <span class="keyword">this</span>.$thumbImageContainer.find(<span class="stringliteral">&quot;.fv__thumb-page&quot;</span>).length;</div><div class="line">            <span class="keywordflow">if</span>(cnt &lt; 1) {</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            let $pageThumb = $(e.currentTarget);</div><div class="line">            <span class="keyword">const</span> pageIndex = $pageThumb.data(<span class="stringliteral">&quot;page-index&quot;</span>);</div><div class="line">            <span class="keyword">const</span> isCtrlKey = (isMacOS &amp;&amp; e.metaKey) || (!isMacOS &amp;&amp; e.ctrlKey);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (isCtrlKey) {</div><div class="line">                <span class="comment">// 多选</span></div><div class="line">                <span class="keywordflow">if</span> (e.button === 2) {</div><div class="line">                    $pageThumb.addClass(<span class="stringliteral">&quot;fv__active&quot;</span>);</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    $pageThumb.toggleClass(<span class="stringliteral">&quot;fv__active&quot;</span>);</div><div class="line">                }</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                <span class="comment">// 单选</span></div><div class="line">                <span class="keyword">const</span> isCurrentItemActive = this.$thumbImageContainer.find(<span class="stringliteral">&#39;.fv__thumb-page.fv__active[data-page-index=&quot;&#39;</span> + pageIndex + <span class="stringliteral">&#39;&quot;]&#39;</span>).length &gt; 0;</div><div class="line">                <span class="keywordflow">if</span> (!(e.button === 2 &amp;&amp; isCurrentItemActive)) {</div><div class="line">                    this.$html.find(<span class="stringliteral">&quot;.fv__active&quot;</span>).removeClass(<span class="stringliteral">&quot;fv__active&quot;</span>);</div><div class="line">                }</div><div class="line">                $pageThumb.addClass(<span class="stringliteral">&quot;fv__active&quot;</span>);</div><div class="line">            }</div><div class="line">            this.fromClickThumb = pageIndex;</div><div class="line">            this.doPageAction(this.previePageIndex, pageIndex);</div><div class="line">            this.previePageIndex = pageIndex;</div><div class="line">            this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().<a name="a12"></a>goToPage(pageIndex, 0, 0, <span class="keyword">false</span>);</div><div class="line">            (!this.resizing &amp;&amp; !this.moving) &amp;&amp; this.calcThumbnailRect(<span class="keyword">true</span>, pageIndex);</div><div class="line">        });</div><div class="line"></div><div class="line">        this.<a class="code" href="class_component.html#a980cf1c65fa4f6673b0bd81a5ff8788d">addDestroyHook</a>(() =&gt; {</div><div class="line">            this.$thumbImageContainerBox.off(<span class="stringliteral">&quot;mouseup&quot;</span>);</div><div class="line">        });</div><div class="line"></div><div class="line">        <span class="comment">// 监听删除键</span></div><div class="line">        <span class="keyword">const</span> delKeyHandle = async (e) =&gt; {</div><div class="line">            <span class="keyword">const</span> defaultDeleteBinderName = this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().pdfViewer.keyboard.defaultDeleteBinderName;</div><div class="line">            <span class="keywordflow">if</span>(!this.parent.isActive || defaultDeleteBinderName !== <span class="stringliteral">&#39;thumbUIComponent&#39;</span>) {</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span> (this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().pdfViewer.<a name="a13"></a><a class="code" href="class_p_d_f_viewer.html#a24e8edd58fae54a9eb9f1d3ad5518193">getAllActivatedElements</a>().length) <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">            <span class="keyword">const</span> docRender = await this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().<a class="code" href="class_p_d_f_viewer.html#a6f6e9b9bc0c421f649317010b3faf00e">getPDFDocRender</a>();</div><div class="line">            <span class="keywordflow">if</span>(!docRender) {</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            <span class="keyword">const</span> permission = docRender.getUserPermission().getValue();</div><div class="line">            <span class="keywordflow">if</span> (</div><div class="line">                !(</div><div class="line">                    permission &amp; PDFDocPermission.Assemble ||</div><div class="line">                    permission &amp; PDFDocPermission.ModifyDocument</div><div class="line">                )</div><div class="line">            ) {</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            <span class="comment">// fix 在有弹框和其他focus的情况不能触发删除</span></div><div class="line">            <span class="keyword">const</span> targetClassName = e.nativeEvent.target.className;</div><div class="line">            <span class="keyword">const</span> modal = $(<span class="stringliteral">&#39;.fv__ui-layer-modal&#39;</span>);</div><div class="line">            <span class="keywordflow">if</span>((modal.length &gt; 0 || targetClassName !== <span class="stringliteral">&#39;fv__thumb-image-container-box&#39;</span>)) <span class="keywordflow">return</span>;</div><div class="line">            <span class="keyword">const</span> $pages = this.$pages;</div><div class="line">            <span class="keyword">const</span> $activePages = this.$html.find(<span class="stringliteral">&quot;.fv__active&quot;</span>);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> ($pages.length &lt;= 1) {</div><div class="line">                this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().<a name="a14"></a>alert(<span class="stringliteral">&quot;thumbnail:removePageAlert&quot;</span>, undefined, undefined, <span class="stringliteral">&#39;warning&#39;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span> ($activePages.length &gt;= $pages.length) {</div><div class="line">                this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().alert(<span class="stringliteral">&quot;thumbnail:removePageAlert&quot;</span>, undefined, undefined, <span class="stringliteral">&#39;warning&#39;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().<a name="a15"></a>confirm(<span class="stringliteral">&quot;thumbnail:removePageConfirm&quot;</span>, undefined, undefined, <span class="stringliteral">&#39;prompt&#39;</span>).then(async () =&gt; {</div><div class="line">                let ids = [];</div><div class="line">                $activePages.each((index, item) =&gt; {</div><div class="line">                    ids.push($(item).data(<span class="stringliteral">&quot;page-index&quot;</span>));</div><div class="line">                });</div><div class="line">                <span class="keywordflow">if</span> (ids.length &gt; 0) {</div><div class="line">                    ids = ids.sort(<span class="keyword">function</span>(x, y) {</div><div class="line">                        <span class="keywordflow">return</span> y - x;</div><div class="line">                    });</div><div class="line"></div><div class="line">                    <span class="keywordflow">for</span> (let i=0; i&lt;ids.length; i++) {</div><div class="line">                        await this.controller.deletePageByIndex(ids[i]);</div><div class="line">                        await <span class="keyword">new</span> Promise(resolve =&gt; setTimeout(resolve, 50));</div><div class="line">                    }</div><div class="line">                    <span class="comment">// Ensure indexesRange from small to large.</span></div><div class="line">                    <span class="keyword">const</span> indexesRange = Array.from(ids).reverse().map((index) =&gt; [index, index]);</div><div class="line">                    this.controller.currentPDFDoc.updatePageLabelsByAction(<span class="stringliteral">&#39;deletePages&#39;</span>, [indexesRange]);</div><div class="line">                }</div><div class="line">            }, () =&gt; {});</div><div class="line">        };</div><div class="line"></div><div class="line">        this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().pdfViewer.<a name="a16"></a><a class="code" href="class_p_d_f_viewer.html#abfc4a9b5c4b3f1e366ec23bb782a0ab4">onShortcutKey</a>(<span class="stringliteral">&#39;delete&#39;</span>, delKeyHandle);</div><div class="line"></div><div class="line">        this.<a class="code" href="class_component.html#a980cf1c65fa4f6673b0bd81a5ff8788d">addDestroyHook</a>(() =&gt; {</div><div class="line">            this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().pdfViewer.<a name="a17"></a><a class="code" href="class_p_d_f_viewer.html#a032a01c914031c8161546a16c025ca0e">offShortcutKey</a>(<span class="stringliteral">&#39;delete&#39;</span>, delKeyHandle);</div><div class="line">        });</div><div class="line"></div><div class="line">    }</div><div class="line">    dragFileInsert(data) {</div><div class="line">        <span class="comment">// 自定义发送GA事件</span></div><div class="line">        this.pdfUI.customs.sendGAEvent({</div><div class="line">            category: <span class="stringliteral">&#39;Organize&#39;</span>,</div><div class="line">            label: <span class="stringliteral">&#39;organize_tab&#39;</span>,</div><div class="line">            action: <span class="stringliteral">&#39;insert_page_by_dragging&#39;</span>,</div><div class="line">            eventKey: <span class="stringliteral">&#39;Insert page by dragging&#39;</span></div><div class="line">        });</div><div class="line">        <span class="keyword">const</span> isAccountExpired = this.pdfUI.customs.isAccountExpired();</div><div class="line">        <span class="keywordflow">if</span> (isAccountExpired) {</div><div class="line">            this.dragable._removeClass(this.dragable.options.chosenClass, data.target);</div><div class="line">            <span class="keywordflow">return</span>;</div><div class="line">        }</div><div class="line">        <span class="keyword">const</span> dragFileInsert = DragFileInsert.getInstance({</div><div class="line">            component: <span class="keyword">this</span>,</div><div class="line">            pdfUI: this.pdfUI</div><div class="line">        });</div><div class="line">        dragFileInsert.start(data);</div><div class="line">    }</div><div class="line">    <span class="comment">// 是否可拖动</span></div><div class="line">    enableDragAndDrop(enable) {</div><div class="line">        <span class="keywordflow">if</span> (!this.dragable) <span class="keywordflow">return</span>;</div><div class="line">        this.dragable.options.allowDrag = !!<a name="a18"></a><a class="code" href="class_component.html#af659603312b1770279f3722f8ea303a4">enable</a>;</div><div class="line">        <span class="comment">// this.sortable.options.disabled = !enable;</span></div><div class="line">        <span class="comment">// this.sortable.options.disabled = true;</span></div><div class="line">    }</div><div class="line"></div><div class="line">    async _checkAndGetLabels() {</div><div class="line">        <span class="comment">// 检查 doc 是否标记了 page label</span></div><div class="line">        <span class="comment">// 如果标记，获取 labels</span></div><div class="line">        <span class="keyword">const</span> hasLabel = await this.controller.currentPDFDoc.checkDocHasPageLabel();</div><div class="line">        let labels = null;</div><div class="line">        <span class="keywordflow">if</span> (hasLabel) {</div><div class="line">           labels = await this.controller.currentPDFDoc.getPageLabels();</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span> { hasLabel, labels };</div><div class="line">    }</div><div class="line">    <span class="comment">// 初始化项</span></div><div class="line">    async initPageItems(pageCount) {</div><div class="line">        <span class="keyword">const</span> logicalPageNumChecked = isPageLabelSetting();</div><div class="line">        let hasLabel = <span class="keyword">false</span>;</div><div class="line">        let labels = [];</div><div class="line">        <span class="keywordflow">if</span> (logicalPageNumChecked) {</div><div class="line">            <span class="keyword">const</span> labelsObj = await this._checkAndGetLabels();</div><div class="line">            hasLabel = labelsObj.hasLabel;</div><div class="line">            labels = labelsObj.labels;</div><div class="line">        }</div><div class="line">        let $oldPages = this.$pages;</div><div class="line">        <span class="keywordflow">if</span> (!$oldPages || $oldPages.length == 0) {</div><div class="line">            let pageItems = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line">            <span class="keywordflow">for</span> (let i = 0; i &lt; pageCount; i++) {</div><div class="line">                <span class="keyword">const</span> label = logicalPageNumChecked &amp;&amp; hasLabel ? htmlCharacter2Entity(labels[i]) : i + 1;</div><div class="line">                pageItems += compileThumbTemplate({ <a name="a19"></a><a class="code" href="class_component.html#af49d257fe5075d69ab751f84645f9ece">index</a>: i, label });</div><div class="line">            }</div><div class="line"></div><div class="line">            this.$thumbImageContainer.append(pageItems);</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            this.$pages.find(<span class="stringliteral">&#39;.fv__thumb-page-container&#39;</span>).addClass(<span class="stringliteral">&quot;loading&quot;</span>);</div><div class="line">            let $canvases = this.$thumbImageContainer.find(<span class="stringliteral">&quot;canvas&quot;</span>);</div><div class="line">            $canvases.each(index =&gt; $canvases[index].width = $canvases[index].width);</div><div class="line">            this.$thumbImageContainer.find(<span class="stringliteral">&quot;.fv__thumb-page-index&quot;</span>).each((i, el) =&gt; {</div><div class="line">                <span class="keywordflow">if</span> (i &gt;= pageCount) {</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keyword">const</span> label = logicalPageNumChecked &amp;&amp; hasLabel ? htmlCharacter2Entity(labels[i]) : i + 1;</div><div class="line">                $(el).html(label);</div><div class="line">            });</div><div class="line"></div><div class="line">            let diffCount = pageCount - $canvases.length;</div><div class="line">            let index = 0;</div><div class="line">            <span class="keywordflow">if</span> (diffCount &lt; 0) {</div><div class="line">                <span class="keywordflow">while</span> (index &lt; -diffCount) {</div><div class="line">                    $($oldPages.get($canvases.length - index - 1)).<span class="keyword">remove</span>();</div><div class="line">                    index++;</div><div class="line">                }</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                let pageItems = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line">                <span class="keywordflow">for</span> (let i = 0; i &lt; diffCount; i++) {</div><div class="line">                    <span class="keyword">const</span> idx = $canvases.length + i;</div><div class="line">                    <span class="keyword">const</span> label = hasLabel ? htmlCharacter2Entity(labels[idx]) : idx + 1;</div><div class="line">                    pageItems += compileThumbTemplate({ <a class="code" href="class_component.html#af49d257fe5075d69ab751f84645f9ece">index</a>: idx, label });</div><div class="line">                }</div><div class="line">                this.$thumbImageContainer.append(pageItems);</div><div class="line">            }</div><div class="line"></div><div class="line">            $oldPages.show();</div><div class="line">        }</div><div class="line">        this.$pages = this.$thumbImageContainer.find(<span class="stringliteral">&quot;.fv__thumb-page&quot;</span>);</div><div class="line">        this.visiblePages = [];</div><div class="line"></div><div class="line">        this.initThumbnailRect();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// 初始化缩略图显示框</span></div><div class="line">    initThumbnailRect() {</div><div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="group___device_info.html#ga3acdbc499923bf65dcc6039f9ebd9463">isDesktop</a>) <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">        let rectTarget = null;</div><div class="line">        let startPos = { x: 0, y: 0, w: 0, h: 0 };</div><div class="line">        let elePos = { x: 0, y: 0 };</div><div class="line">        let eleRect = {};</div><div class="line">        let parentRect = {};</div><div class="line">        let thumbRect = {};</div><div class="line">        let $rects = this.$thumbImageContainer.find(<span class="stringliteral">&#39;.fv__thumb-view-rect&#39;</span>);</div><div class="line"></div><div class="line">        !this.evTnRectDown &amp;&amp; $rects.on(<span class="stringliteral">&#39;mousedown&#39;</span>, this.evTnRectDown = ev =&gt; {</div><div class="line">            <span class="keywordflow">if</span> (ev.target.className.indexOf(<span class="stringliteral">&#39;fv__thumb-view-rect&#39;</span>) &gt;= 0) {</div><div class="line">                ev.stopPropagation();</div><div class="line">                let target = ev.target;</div><div class="line">                eleRect = target.getBoundingClientRect();</div><div class="line">                parentRect = target.parentElement.getBoundingClientRect();</div><div class="line">                thumbRect = $(target.parentElement).find(<span class="stringliteral">&#39;.fv__thumb-image&#39;</span>).get(0).getBoundingClientRect();</div><div class="line">                let mouseX = ev.clientX - eleRect.left;</div><div class="line">                let mouseY = ev.clientY - eleRect.top;</div><div class="line">                rectTarget = target;</div><div class="line"></div><div class="line">                startPos.x = ev.clientX;</div><div class="line">                startPos.y = ev.clientY;</div><div class="line">                startPos.w = parseInt(rectTarget.style.width || 0, 10);</div><div class="line">                startPos.h = parseInt(rectTarget.style.height || 0, 10);</div><div class="line"></div><div class="line">                <span class="comment">// 右下角 15 x 15 大小调整区</span></div><div class="line">                <span class="keywordflow">if</span> (mouseX &gt; eleRect.width - 15 &amp;&amp; mouseY &gt; eleRect.height - 15) {</div><div class="line">                    let $eleRect = this.$thumbImageContainer.find(<span class="stringliteral">&#39;.fv__thumb-page .fv__thumb-view-rect.fv__rect_active&#39;</span>);</div><div class="line">                    let $eleThumb = $eleRect.parent().find(<span class="stringliteral">&#39;.fv__thumb-image&#39;</span>);</div><div class="line">                    $eleRect.css(<span class="stringliteral">&#39;max-width&#39;</span>, $eleThumb.outerWidth() + RECT_BORDER_WIDTH)</div><div class="line">                            .css(<span class="stringliteral">&#39;max-height&#39;</span>, $eleThumb.outerHeight() + RECT_BORDER_WIDTH);</div><div class="line"></div><div class="line">                    this.resizing = <span class="keyword">true</span>;</div><div class="line">                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                this.moving = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">                elePos.x = parseInt(rectTarget.style.left || 0, 10);</div><div class="line">                elePos.y = parseInt(rectTarget.style.top || 0, 10);</div><div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        !this.evDocUp &amp;&amp; $(document).<a name="a20"></a><a class="code" href="class_component.html#a33f00cbd4285549c484ddb8dcb919277">on</a>(<span class="stringliteral">&#39;mouseup&#39;</span>, this.evDocUp = ev =&gt; {</div><div class="line">            <span class="keywordflow">if</span> (this.resizing || this.moving) {</div><div class="line">                let $eleRect = this.$thumbImageContainer.find(<span class="stringliteral">&#39;.fv__thumb-page .fv__thumb-view-rect.fv__rect_active&#39;</span>);</div><div class="line">                $eleRect.css(<span class="stringliteral">&#39;max-width&#39;</span>, <span class="stringliteral">&#39;&#39;</span>)</div><div class="line">                        .css(<span class="stringliteral">&#39;max-height&#39;</span>, <span class="stringliteral">&#39;&#39;</span>);</div><div class="line"></div><div class="line">                let isOnlyMoving = <span class="keyword">false</span>;</div><div class="line">                ev.stopPropagation();</div><div class="line">                this.resizing = <span class="keyword">false</span>;</div><div class="line">                <span class="keywordflow">if</span> (this.moving &amp;&amp; !this.resizing) isOnlyMoving = <span class="keyword">true</span>;</div><div class="line">                this.rectZoomToPage(isOnlyMoving);</div><div class="line">                this.moving = <span class="keyword">false</span>;</div><div class="line">                rectTarget = null;</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        !this.evDocMove &amp;&amp; $(document).<a class="code" href="class_component.html#a33f00cbd4285549c484ddb8dcb919277">on</a>(<span class="stringliteral">&#39;mousemove&#39;</span>, this.evDocMove = ev =&gt; {</div><div class="line">            <span class="keywordflow">if</span> (this.resizing) {</div><div class="line">                ev.preventDefault();</div><div class="line">                ev.stopPropagation();</div><div class="line"></div><div class="line">                let w = ev.clientX - startPos.x;</div><div class="line">                let h = ev.clientY - startPos.y;</div><div class="line"></div><div class="line">                rectTarget.style.width = (startPos.w + w) + <span class="stringliteral">&#39;px&#39;</span>;</div><div class="line">                rectTarget.style.height = (startPos.h + h) + <span class="stringliteral">&#39;px&#39;</span>;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span> (this.moving &amp;&amp; rectTarget) {</div><div class="line">                ev.preventDefault();</div><div class="line">                ev.stopPropagation();</div><div class="line"></div><div class="line">                let x = ev.clientX - startPos.x;</div><div class="line">                let y = ev.clientY - startPos.y;</div><div class="line">                let top = elePos.y + y;</div><div class="line">                let <a name="a21"></a><a class="code" href="group___consts_p_d_f.html#ggacdfaca60ec19c0265bac2692d7982726ac9db6893f15f10cc1c29bf33d486fe05">left</a> = elePos.x + x;</div><div class="line">                let offsetLeft = thumbRect.left - parentRect.left - THUMB_BORDER_WIDTH;</div><div class="line">                let offsetTop = thumbRect.top - parentRect.top - THUMB_BORDER_WIDTH;</div><div class="line"></div><div class="line">                top = Math.min(Math.max(top, offsetTop - THUMB_BORDER_WIDTH), offsetTop + thumbRect.height - eleRect.height);</div><div class="line">                left = Math.min(Math.max(left, offsetLeft - THUMB_BORDER_WIDTH), offsetLeft + thumbRect.width - eleRect.width);</div><div class="line"></div><div class="line">                rectTarget.style.top = top + <span class="stringliteral">&#39;px&#39;</span>;</div><div class="line">                rectTarget.style.left = left + <span class="stringliteral">&#39;px&#39;</span>;</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    rectZoomToPage(isMoving = <span class="keyword">false</span>) {</div><div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="group___device_info.html#ga3acdbc499923bf65dcc6039f9ebd9463">isDesktop</a>) <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">        let pdfViewer = this.pdfUI.pdfViewer;</div><div class="line">        let pdfDocRender = pdfViewer.getPDFDocRender();</div><div class="line">        let scrollWrap = pdfDocRender.viewerRender.scrollWrap;</div><div class="line">        let pageIndex = pdfDocRender.getCurrentPageIndex();</div><div class="line">        let pdfPageRender = pdfViewer.getPDFPageRender(pageIndex);</div><div class="line">        let prevScale = pdfPageRender.getScale();</div><div class="line">        let $eleRect = this.$thumbImageContainer.find(<span class="stringliteral">&#39;.fv__thumb-page .fv__thumb-view-rect.fv__rect_active&#39;</span>);</div><div class="line">        let $eleThumb = $eleRect.parent().find(<span class="stringliteral">&#39;.fv__thumb-image&#39;</span>);</div><div class="line">        let $thumbPage = $eleThumb.parents(<span class="stringliteral">&#39;.fv__thumb-page&#39;</span>);</div><div class="line">        let thumbPos = $eleThumb.position();</div><div class="line">        let rectPos = $eleRect.position();</div><div class="line">        <span class="comment">// 可视框大小</span></div><div class="line">        let viewportSize = {</div><div class="line">            width: scrollWrap.getWidth(),</div><div class="line">            height: scrollWrap.getHeight()</div><div class="line">        };</div><div class="line">        <span class="comment">// 缩略图大小</span></div><div class="line">        let thumbInfo = {</div><div class="line">            pos: {</div><div class="line">                x: $eleThumb.offset().left - $thumbPage.offset().left + THUMB_BORDER_WIDTH,</div><div class="line">                y: $eleThumb.offset().top - $thumbPage.offset().top + THUMB_BORDER_WIDTH</div><div class="line">            },</div><div class="line">            <a name="a22"></a><a class="code" href="class_container_component.html#a775bfb88c1bb7975d67f277eade2a1b7">size</a>: {</div><div class="line">                width: $eleThumb.outerWidth() - THUMB_BORDER_WIDTH,</div><div class="line">                height: $eleThumb.outerHeight() - THUMB_BORDER_WIDTH</div><div class="line">            }</div><div class="line">        };</div><div class="line">        let pdfPageSize = {</div><div class="line">            width: pdfPageRender.getShowWidth() / prevScale,</div><div class="line">            height: pdfPageRender.getShowHeight() / prevScale</div><div class="line">        };</div><div class="line">        let rectInfo = {</div><div class="line">            pos: {</div><div class="line">                x: rectPos.left - thumbInfo.pos.x + RECT_BORDER_WIDTH,</div><div class="line">                y: rectPos.top - thumbInfo.pos.y + RECT_BORDER_WIDTH</div><div class="line">            },</div><div class="line">            <a class="code" href="class_container_component.html#a775bfb88c1bb7975d67f277eade2a1b7">size</a>: {</div><div class="line">                width: $eleRect.outerWidth() - RECT_BORDER_WIDTH * 2,</div><div class="line">                height: $eleRect.outerHeight() - RECT_BORDER_WIDTH * 2</div><div class="line">            }</div><div class="line">        };</div><div class="line"></div><div class="line">        let width = rectInfo.size.width;</div><div class="line">        let height = rectInfo.size.height;</div><div class="line"></div><div class="line">        <span class="comment">// 宽高调整到可视窗口同比例</span></div><div class="line">        <span class="keywordflow">if</span> (width / viewportSize.width &lt; height / viewportSize.height) {</div><div class="line">            width = height * viewportSize.width / viewportSize.height;</div><div class="line">        }</div><div class="line"></div><div class="line">        let pdfShowWidth = width / thumbInfo.size.width * pdfPageSize.width;</div><div class="line"></div><div class="line">        let scale = viewportSize.width / pdfShowWidth;</div><div class="line">        let x = rectInfo.pos.x / thumbInfo.size.width * pdfPageSize.width * prevScale;</div><div class="line">        let y = rectInfo.pos.y / thumbInfo.size.height * pdfPageSize.height * prevScale;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (isMoving) {</div><div class="line">            pdfViewer.zoomTo(undefined, {</div><div class="line">                x,</div><div class="line">                y,</div><div class="line">                pageIndex,</div><div class="line">                type:<span class="stringliteral">&#39;device&#39;</span></div><div class="line">            });</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            pdfViewer.zoomTo(scale, {</div><div class="line">                x: this.prevPos.x / prevScale * scale,</div><div class="line">                y: this.prevPos.y / prevScale * scale,</div><div class="line">                pageIndex,</div><div class="line">                type:<span class="stringliteral">&#39;device&#39;</span></div><div class="line">            });</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// 计算缩略图中框</span></div><div class="line">    calcThumbnailRect(isPageChanged = <span class="keyword">false</span>, newPageIndex = 0) {</div><div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="group___device_info.html#ga3acdbc499923bf65dcc6039f9ebd9463">isDesktop</a>) <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">        let pageIndex = this.cachePageIndex || 0;</div><div class="line">        let $rects = this.$thumbImageContainer.find(<span class="stringliteral">&#39;.fv__thumb-view-rect&#39;</span>);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(!$rects.length)<span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (isPageChanged || !$($rects[pageIndex]).hasClass(<span class="stringliteral">&#39;fv__rect_active&#39;</span>)) {</div><div class="line">            $rects.hide().removeClass(<span class="stringliteral">&#39;fv__rect_active&#39;</span>);</div><div class="line">            this.cachePageIndex = pageIndex = newPageIndex;</div><div class="line">        }</div><div class="line"></div><div class="line">        let $eleRect = $($rects[pageIndex]);</div><div class="line">        let $eleThumb = $eleRect.parent().find(<span class="stringliteral">&#39;.fv__thumb-image&#39;</span>);</div><div class="line">        let $thumbPage = $eleThumb.parents(<span class="stringliteral">&#39;.fv__thumb-page&#39;</span>);</div><div class="line">        let thumbPos = $eleThumb.position();</div><div class="line">        let pdfPageRender = this.pdfUI.pdfViewer.getPDFPageRender(pageIndex);</div><div class="line">        let thumbInfo = {</div><div class="line">            pos: {</div><div class="line">                x: $eleThumb.offset().left - $thumbPage.offset().left,</div><div class="line">                y: thumbPos.top</div><div class="line">            },</div><div class="line">            <a class="code" href="class_container_component.html#a775bfb88c1bb7975d67f277eade2a1b7">size</a>: {</div><div class="line">                width: $eleThumb.width(),</div><div class="line">                height: $eleThumb.height()</div><div class="line">            }</div><div class="line">        };</div><div class="line">        let pageVisibleRect = pdfPageRender.getContainerVisibleRect();</div><div class="line">        let pdfPageInfo = {</div><div class="line">            visible: {</div><div class="line">                x: pageVisibleRect.left,</div><div class="line">                y: pageVisibleRect.top,</div><div class="line">                width: pageVisibleRect.right - pageVisibleRect.left,</div><div class="line">                height: pageVisibleRect.bottom - pageVisibleRect.top</div><div class="line">            },</div><div class="line">            <a class="code" href="class_container_component.html#a775bfb88c1bb7975d67f277eade2a1b7">size</a>: {</div><div class="line">                width: pdfPageRender.getShowWidth(),</div><div class="line">                height: pdfPageRender.getShowHeight()</div><div class="line">            }</div><div class="line">        };</div><div class="line"></div><div class="line">        let x = thumbInfo.pos.x + pdfPageInfo.visible.x * (thumbInfo.size.width / pdfPageInfo.size.width);</div><div class="line">        let y = thumbInfo.pos.y + pdfPageInfo.visible.y * (thumbInfo.size.height / pdfPageInfo.size.height);</div><div class="line">        let width = pdfPageInfo.visible.width * (thumbInfo.size.width / pdfPageInfo.size.width);</div><div class="line">        let height = pdfPageInfo.visible.height * (thumbInfo.size.height / pdfPageInfo.size.height);</div><div class="line"></div><div class="line">        this.prevPos.x = pdfPageInfo.visible.x;</div><div class="line">        this.prevPos.y = pdfPageInfo.visible.y;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (Number.isNaN(width) || width &lt;= 0 || Number.isNaN(height) || height &lt;= 0) <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">        $eleRect.css(<span class="stringliteral">&#39;top&#39;</span>, y - RECT_BORDER_WIDTH)</div><div class="line">                .css(<span class="stringliteral">&#39;left&#39;</span>, x - RECT_BORDER_WIDTH)</div><div class="line">                .css(<span class="stringliteral">&#39;width&#39;</span>, width + RECT_BORDER_WIDTH * 2)</div><div class="line">                .css(<span class="stringliteral">&#39;height&#39;</span>, height + RECT_BORDER_WIDTH * 2)</div><div class="line">                .show()</div><div class="line">                .addClass(<span class="stringliteral">&#39;fv__rect_active&#39;</span>);</div><div class="line"></div><div class="line">        isSafari &amp;&amp; $eleRect.addClass(<span class="stringliteral">&#39;fv__thumb-view-safari&#39;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    updateVisiblePages(enforce) {</div><div class="line">        <span class="comment">// if thumb container isn&#39;t visible, don&#39;t render it.</span></div><div class="line">        <span class="keywordflow">if</span>(!$(this.element).is(<span class="stringliteral">&#39;:visible&#39;</span>)) {</div><div class="line">            <span class="keywordflow">return</span>;</div><div class="line">        }</div><div class="line">        <span class="comment">// adjust container&#39;s flex layout strategy before update</span></div><div class="line">        adjustContainerFlexBox(this.$thumbImageContainer);</div><div class="line">        <span class="keyword">const</span> $pages = this.$pages;</div><div class="line">        let visiblePages = [];</div><div class="line"></div><div class="line">        let visibleClientRect = this.$thumbImageContainer.parent()[0].getBoundingClientRect();</div><div class="line"></div><div class="line">        <span class="comment">// Algorithm to calculate the thumbnails currently appearing in the visible area.</span></div><div class="line">        let currentPageIndex = this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().pdfViewer.<a class="code" href="class_p_d_f_viewer.html#a6f6e9b9bc0c421f649317010b3faf00e">getPDFDocRender</a>().getCurrentPageIndex();</div><div class="line">        <span class="keyword">const</span> pageCount = this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().pdfViewer.<a name="a23"></a><a class="code" href="class_p_d_f_viewer.html#a86658653c0815911b4d3621211d55f3b">getCurrentPDFDoc</a>().getPageCount();</div><div class="line">        <span class="keywordflow">if</span> (currentPageIndex &gt;= pageCount) {</div><div class="line">            currentPageIndex = pageCount - 1;</div><div class="line">        }</div><div class="line">        let i = currentPageIndex, j = currentPageIndex + 1;</div><div class="line">        <span class="keywordflow">while</span> (i &gt;= 0) {</div><div class="line">            let clientRect = $pages[i].getBoundingClientRect();</div><div class="line">            <span class="keywordflow">if</span> (clientRect.bottom &lt; visibleClientRect.top) {</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span> (isRectsOverlap(clientRect, visibleClientRect)) {</div><div class="line">                visiblePages.unshift(i);</div><div class="line">            }</div><div class="line">            i--;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">while</span> (j &lt; $pages.length) {</div><div class="line">            let clientRect = $pages[j].getBoundingClientRect();</div><div class="line">            <span class="keywordflow">if</span> (clientRect.top &gt; visibleClientRect.bottom) {</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span> (isRectsOverlap(clientRect, visibleClientRect)) {</div><div class="line">                visiblePages.push(j);</div><div class="line">            }</div><div class="line">            j++;</div><div class="line">        }</div><div class="line">        <span class="keyword">const</span> currentScaleRatio = this.zoomService.getScaleRatio();</div><div class="line">        <span class="comment">// The current is the same as the last time.</span></div><div class="line">        <span class="keywordflow">if</span> (!enforce</div><div class="line">            &amp;&amp; this.visiblePages.length === visiblePages.length</div><div class="line">            &amp;&amp; !<span class="keyword">this</span>.visiblePages.reduce((pre, pageIdx, idx) =&gt; pre ^ pageIdx ^ visiblePages[idx], 0)</div><div class="line">            &amp;&amp; this.lastScaleRatio === currentScaleRatio) {</div><div class="line">            <span class="keywordflow">return</span>;</div><div class="line">        }</div><div class="line">        this.visiblePages = visiblePages;</div><div class="line">        this.lastScaleRatio = currentScaleRatio;</div><div class="line"></div><div class="line">        <span class="keyword">const</span> promises = visiblePages.map(i =&gt; {</div><div class="line">            <span class="comment">// Update the currently visible thumbnail, because of enlarge/reduce feature.</span></div><div class="line">            <span class="keywordflow">return</span> this.controller.updatePageThumbImg(i);</div><div class="line">        });</div><div class="line">        <span class="keywordflow">return</span> Promise.all(promises);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// 插入缩略图</span></div><div class="line">    insertThumb(pageIndex, needGoto = <span class="keyword">true</span>) {</div><div class="line">        let pageNum = pageIndex + 1;</div><div class="line">        let htmlTemplate = compileThumbTemplate(pageNum);</div><div class="line">        <span class="comment">// change page width/height if scaleLevel not equal INITIALIZE value</span></div><div class="line">        <span class="keywordflow">if</span> (!this.zoomService.scaleEqualInitialize()) {</div><div class="line">            let $htmlTemplate = $(htmlTemplate);</div><div class="line">            <span class="keyword">const</span> width = THUMBNAIL_PAGE_BASIS_WIDTH * this.zoomService.zoomToScaleRatio;</div><div class="line">            <span class="keyword">const</span> height = THUMBNAIL_PAGE_BASIS_HEIGHT * this.zoomService.zoomToScaleRatio;</div><div class="line">            $htmlTemplate.css({</div><div class="line">                width: `${width}px`,</div><div class="line">                height: `${height}px`</div><div class="line">            })</div><div class="line">            htmlTemplate = $htmlTemplate;</div><div class="line">        }</div><div class="line">        <span class="comment">// replace pages 功能可能会删除完后再插入缩略图</span></div><div class="line">        <span class="keywordflow">if</span> (this.$pages.length === 0) {</div><div class="line">            this.$thumbImageContainer.append(htmlTemplate);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (pageIndex == this.$pages.length) {</div><div class="line">            $(this.$pages[pageIndex - 1]).<a name="a24"></a><a class="code" href="class_component.html#aff0784810960e6cfcf9a0af882529cda">after</a>(htmlTemplate);</div><div class="line">        } <span class="keywordflow">else</span></div><div class="line">            $(this.$pages[pageIndex]).<a name="a25"></a><a class="code" href="class_component.html#a947c7a3d0fb01f606f8374fca7eeaf8b">before</a>(htmlTemplate);</div><div class="line"></div><div class="line">        this.$pages = this.$thumbImageContainer.find(<span class="stringliteral">&quot;.fv__thumb-page&quot;</span>);</div><div class="line">        <span class="keywordflow">if</span> (needGoto) {</div><div class="line">            this.updatePageLabel(pageIndex);</div><div class="line">            this.updateVisiblePages(<span class="keyword">true</span>);</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// 移除缩略图</span></div><div class="line">    removeThumb(index) {</div><div class="line">        let $pages = this.$pages;</div><div class="line">        <span class="keywordflow">if</span> (!$pages) <span class="keywordflow">return</span>;</div><div class="line">        $pages[<a class="code" href="class_component.html#af49d257fe5075d69ab751f84645f9ece">index</a>].remove();</div><div class="line"></div><div class="line">        this.$pages = this.$thumbImageContainer.find(<span class="stringliteral">&quot;.fv__thumb-page&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line">        this.updatePageLabel(index);</div><div class="line">        this.updateVisiblePages(<span class="keyword">true</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// 载入图片</span></div><div class="line">    removeThumbs(pageIndexes){</div><div class="line">        pageIndexes.forEach(index=&gt;{</div><div class="line">            let $pages = this.$pages;</div><div class="line">            <span class="keywordflow">if</span>(!$pages)<span class="keywordflow">return</span>;</div><div class="line">            $pages[<a class="code" href="class_component.html#af49d257fe5075d69ab751f84645f9ece">index</a>].remove();</div><div class="line">        })</div><div class="line">        this.$pages=this.$thumbImageContainer.find(<span class="stringliteral">&#39;.fv__thumb-page&#39;</span>);</div><div class="line">        <span class="comment">// pageIndexes.forEach(index=&gt;this.updatePageLabel(index)) // PageLabel update by Event.pageLabelChange triggered</span></div><div class="line">        this.updateVisiblePages(<span class="keyword">true</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    displayThumbImg(pageIndex, data) {</div><div class="line">        let $pageThumb = $(this.$pages[pageIndex]);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>($pageThumb.length &lt; 1) {</div><div class="line">            <span class="keywordflow">return</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        let eCanvas = $pageThumb.find(<span class="stringliteral">&quot;.fv__thumb-image&quot;</span>)[0];</div><div class="line">        eCanvas.removeClass(<span class="stringliteral">&quot;fv__hide&quot;</span>);</div><div class="line">        eCanvas.width = data.width;</div><div class="line">        eCanvas.height = data.height;</div><div class="line"></div><div class="line">        let $pageContainer = $pageThumb.find(<span class="stringliteral">&quot;.fv__thumb-page-container&quot;</span>)</div><div class="line">        $pageContainer.addClass(<span class="stringliteral">&quot;loading&quot;</span>);</div><div class="line">        <span class="keyword">const</span> ratioCanvas = data.width / data.height;</div><div class="line">        <span class="keyword">const</span> ratioContainer = $pageContainer.width() / $pageContainer.height();</div><div class="line">        <span class="keywordflow">if</span>(ratioContainer !== 0) {</div><div class="line">            <span class="keywordflow">if</span>(ratioCanvas &lt; ratioContainer) {</div><div class="line">                <span class="keyword">const</span> percentRatio = (ratioCanvas / ratioContainer) * 100;</div><div class="line">                eCanvas.style.maxWidth  = percentRatio.toString() + <span class="stringliteral">&quot;%&quot;</span>;</div><div class="line">                eCanvas.style.maxHeight = <span class="stringliteral">&quot;100%&quot;</span>;</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                <span class="keyword">const</span> percentRatio = (ratioContainer / ratioCanvas ) * 100;</div><div class="line">                eCanvas.style.maxHeight  = percentRatio.toString() + <span class="stringliteral">&quot;%&quot;</span>;</div><div class="line">                eCanvas.style.maxWidth = <span class="stringliteral">&quot;100%&quot;</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        let ctx = eCanvas.getContext(<span class="stringliteral">&quot;2d&quot;</span>);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (data.buffer) {</div><div class="line">            let buffer = <span class="keyword">new</span> (Uint8ClampedArray || Uint8Array)(data.buffer);</div><div class="line"></div><div class="line">            let img = ctx.createImageData(data.width, data.height);</div><div class="line">            img.data.set(buffer);</div><div class="line">            ctx.putImageData(img, 0, 0);</div><div class="line">            $pageContainer.removeClass(<span class="stringliteral">&quot;loading&quot;</span>);</div><div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data.image) {</div><div class="line">            let img = <span class="keyword">new</span> <a name="a26"></a><a class="code" href="group___consts_p_d_f.html#gga1ba4aec1508a30f2256d68fc279776f2a41675d4fa29c99fe7e2e71b07889ae98">Image</a>();</div><div class="line"></div><div class="line">            img.onload = <span class="keyword">function</span>() {</div><div class="line">                ctx.drawImage(img, 0, 0);</div><div class="line">                URL.revokeObjectURL(img.src);</div><div class="line">                $pageContainer.removeClass(<span class="stringliteral">&quot;loading&quot;</span>);</div><div class="line">            };</div><div class="line"></div><div class="line">            img.src = URL.createObjectURL(data.image);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (pageIndex === this.cachePageIndex) this.calcThumbnailRect(<span class="keyword">true</span>, pageIndex)</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// 高亮右键菜单页 （已废弃）</span></div><div class="line">    highlightMenuTarget(pageIndex) {</div><div class="line">        let $thumbPages = this.$pages;</div><div class="line">        <span class="keywordflow">if</span> ($thumbPages[pageIndex]) {</div><div class="line">            this.$html</div><div class="line">                .find(<span class="stringliteral">&quot;.fv__active_contextmenu&quot;</span>)</div><div class="line">                .removeClass(<span class="stringliteral">&quot;fv__active_contextmenu&quot;</span>);</div><div class="line"></div><div class="line">            let $activeThumb = $($thumbPages[pageIndex]);</div><div class="line">            $activeThumb.addClass(<span class="stringliteral">&quot;fv__active_contextmenu&quot;</span>);</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// 高亮选中页</span></div><div class="line">    highlightPage(pageIndex, enforce) {</div><div class="line">        this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().pdfViewer.keyboard.defaultDeleteBinderName = <span class="stringliteral">&#39;thumbUIComponent&#39;</span>;</div><div class="line">        <span class="comment">// fix: ONLINERD-2557</span></div><div class="line">        <span class="keyword">const</span> activeEle = this.$html.find(<span class="stringliteral">&quot;.fv__active&quot;</span>);</div><div class="line">        <span class="comment">// fix: ONLINERD-5023(caused by fix ONLINERD-2557)</span></div><div class="line">        <span class="keyword">const</span> hasCurActiveIndex = activeEle.length === 1 &amp;&amp; (activeEle.data(<span class="stringliteral">&#39;page-index&#39;</span>) !== pageIndex);</div><div class="line">        <span class="keyword">const</span> newPageIndex = typeof this.fromClickThumb === <span class="stringliteral">&#39;number&#39;</span> ? this.fromClickThumb : pageIndex;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (this.fromClickThumb !== pageIndex || hasCurActiveIndex) {</div><div class="line">            let thumbPages = this.$html.find(<span class="stringliteral">&quot;.fv__thumb-page&quot;</span>);</div><div class="line">            this.$html.find(<span class="stringliteral">&quot;.fv__active&quot;</span>).removeClass(<span class="stringliteral">&quot;fv__active&quot;</span>);</div><div class="line"></div><div class="line">            let $activeThumb = $(thumbPages[newPageIndex]);</div><div class="line">            $activeThumb.addClass(<span class="stringliteral">&quot;fv__active&quot;</span>);</div><div class="line"></div><div class="line">            let $parent = this.$thumbImageContainerBox;</div><div class="line"></div><div class="line">            <span class="keyword">const</span> thumbTop = $parent.offset().top + 10;</div><div class="line">            let offset = $activeThumb.offset();</div><div class="line">            let top = offset &amp;&amp; offset.top;</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (top &amp;&amp; top !== thumbTop) {</div><div class="line">                let currentTop = $parent.scrollTop();</div><div class="line">                $parent.scrollTop(currentTop + top - thumbTop);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        this.calcThumbnailRect(<span class="keyword">true</span>, newPageIndex);</div><div class="line">        this.doPageAction(this.previePageIndex, pageIndex);</div><div class="line">        this.fromClickThumb = null;</div><div class="line">        this.previePageIndex = pageIndex;</div><div class="line">        this.updateVisiblePages(enforce);</div><div class="line">    }</div><div class="line">    <span class="comment">// 执行page action, 需要执行当前页面的pageOpen action，和源页面pageclose action</span></div><div class="line">    doPageAction(fromPageIndex, targetPageIndex) {</div><div class="line">        <span class="keywordflow">if</span>(fromPageIndex === targetPageIndex || fromPageIndex === undefined) <span class="keywordflow">return</span>;</div><div class="line">        <span class="keyword">const</span> selectedThumb = $(<span class="stringliteral">&#39;.fv__thumb-page.fv__active&#39;</span>);</div><div class="line">        <span class="comment">// 多选情况下不触发action</span></div><div class="line">        <span class="keywordflow">if</span>(selectedThumb.length &gt; 1) <span class="keywordflow">return</span>;</div><div class="line">        <span class="comment">// thumbnailClicked emitter</span></div><div class="line">        this.pdfUI.eventEmitter.emit(Events.thumbnailClicked, { fromPageIndex, targetPageIndex });</div><div class="line">    }</div><div class="line">    <span class="comment">// 更新页码</span></div><div class="line">    async updatePageLabel(from, to) {</div><div class="line">        this.$pages = this.$thumbImageContainer.find(<span class="stringliteral">&quot;.fv__thumb-page&quot;</span>);</div><div class="line">        let $pageThumbs = this.$pages;</div><div class="line">        <span class="keywordflow">if</span> (typeof to === <span class="stringliteral">&#39;undefined&#39;</span>) {</div><div class="line">            to = $pageThumbs.length;</div><div class="line">        }</div><div class="line">        <span class="keyword">const</span> logicalPageNumChecked = isPageLabelSetting();</div><div class="line">        let hasLabel = <span class="keyword">false</span>;</div><div class="line">        let labels = [];</div><div class="line">        <span class="keywordflow">if</span> (logicalPageNumChecked) {</div><div class="line">            <span class="keyword">const</span> labelsObj = await this._checkAndGetLabels();</div><div class="line">            hasLabel = labelsObj.hasLabel;</div><div class="line">            labels = labelsObj.labels;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">for</span> (let i = from; i &lt;= to; i++) {</div><div class="line">            <span class="keyword">const</span> label = logicalPageNumChecked &amp;&amp; hasLabel ? htmlCharacter2Entity(labels[i]) : i + 1;</div><div class="line">            let $pageThumb = $($pageThumbs[i]);</div><div class="line"></div><div class="line">            let $pageIndexDiv = $pageThumb.find(<span class="stringliteral">&quot;.fv__thumb-page-index&quot;</span>);</div><div class="line">            $pageIndexDiv.html(label);</div><div class="line"></div><div class="line">            $pageThumb.attr(<span class="stringliteral">&quot;data-page-index&quot;</span>, i);</div><div class="line">            $pageThumb.data(<span class="stringliteral">&quot;page-index&quot;</span>, i);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    reset() {</div><div class="line">        <span class="keyword">const</span> $rects = this.$thumbImageContainer.find(<span class="stringliteral">&#39;.fv__thumb-view-rect&#39;</span>);</div><div class="line">        resetContainerStyle(this.$thumbImageContainer);</div><div class="line">        this.fromClickThumb = null;</div><div class="line">        $(document).<a name="a27"></a><a class="code" href="class_component.html#ae61217f6dd2dad50ac443ec3bacbb1a8">off</a>(<span class="stringliteral">&#39;mouseup&#39;</span>, this.evDocUp);</div><div class="line">        $(document).<a class="code" href="class_component.html#ae61217f6dd2dad50ac443ec3bacbb1a8">off</a>(<span class="stringliteral">&#39;mousemove&#39;</span>, this.evDocMove);</div><div class="line">        $rects.off(<span class="stringliteral">&#39;mousedown&#39;</span>, this.evTnRectDown);</div><div class="line"></div><div class="line">        this.evDocUp = null;</div><div class="line">        this.evDocMove = null;</div><div class="line">        this.evTnRectDown = null;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// 复制页面</span></div><div class="line">    copyPages(sourceIndexs, destIndex) {</div><div class="line">        <span class="comment">// 构造新数组</span></div><div class="line">        <span class="keyword">const</span> pages = [];</div><div class="line">        let tempArray = [];</div><div class="line">        sourceIndexs.forEach(item =&gt; {</div><div class="line">            <span class="keywordflow">if</span>(tempArray.length &gt; 0 &amp;&amp; item !== tempArray[tempArray.length - 1] + 2) {</div><div class="line">                pages.push(tempArray);</div><div class="line">                tempArray = [];</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span>(tempArray.length &gt; 1) {</div><div class="line">                tempArray[1] = item;</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                tempArray.push(item);</div><div class="line">            }</div><div class="line"></div><div class="line">        });</div><div class="line">        pages.push(tempArray);</div><div class="line">        this.controller.copyPages(pages, destIndex);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// 移动页面</span></div><div class="line">    movePages(sourceIndexs, destIndex) {</div><div class="line">        sourceIndexs = sourceIndexs.map(sourceIndex =&gt; {</div><div class="line">            <span class="keywordflow">return</span> [sourceIndex];</div><div class="line">        })</div><div class="line">        <span class="keyword">const</span> pdfDoc = this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().pdfViewer.currentPDFDoc;</div><div class="line">        pdfDoc.movePagesToThenUpdatePageLabel(sourceIndexs, destIndex);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// 移动页面(外部事件监听)</span></div><div class="line">    movePageImage(src, dst) {</div><div class="line">        <span class="keywordflow">if</span> (this.moveImageDone) {</div><div class="line">            this.moveImageDone = <span class="keyword">false</span>;</div><div class="line">            <span class="keywordflow">return</span>;</div><div class="line">        }</div><div class="line">        let min = Math.min(src, dst);</div><div class="line">        let max = Math.max(src, dst);</div><div class="line">        this.$pages = this.$thumbImageContainer.find(<span class="stringliteral">&quot;.fv__thumb-page&quot;</span>);</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (let i = min; i &lt;= max; i++) {</div><div class="line">            let $pageThumb = this.$pages.eq(i).find(<span class="stringliteral">&#39;.fv__thumb-page-container&#39;</span>);;</div><div class="line">            $pageThumb.addClass(<span class="stringliteral">&quot;loading&quot;</span>);</div><div class="line">        }</div><div class="line"></div><div class="line">        this.updatePageLabel(min, max);</div><div class="line">        this.updateVisiblePages(<span class="keyword">true</span>);</div><div class="line">    }</div><div class="line">    movePagesImage (pageRange, destIndex, pageIdList) {</div><div class="line">        <span class="keyword">const</span> min = Math.min(...pageRange, destIndex);</div><div class="line">        <span class="keyword">const</span> max = Math.max(...pageRange, destIndex)</div><div class="line">        this.$pages = this.$thumbImageContainer.find(<span class="stringliteral">&#39;.fv__thumb-page&#39;</span>);</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (let i = min; i &lt;= max; i++) {</div><div class="line">            let $pageThumb = this.$pages.eq(i).find(<span class="stringliteral">&#39;.fv__thumb-page-container&#39;</span>);</div><div class="line">            $pageThumb.addClass(<span class="stringliteral">&quot;loading&quot;</span>);</div><div class="line">        }</div><div class="line"></div><div class="line">        this.updateVisiblePages(<span class="keyword">true</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// 判断某个模块是否加载</span></div><div class="line">    checkAddonInstance (addonName) {</div><div class="line">        <span class="keyword">const</span> addonMap = this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().addonInstanceMap || {};</div><div class="line">        <span class="keywordflow">return</span> addonMap[addonName];</div><div class="line">    }</div><div class="line">    <span class="comment">// 获取选中的页</span></div><div class="line">    getSelectedPages() {</div><div class="line">        <span class="keyword">const</span> $activePages = this.$html.find(<span class="stringliteral">&quot;.fv__active&quot;</span>);</div><div class="line">        let indexes = [];</div><div class="line">        $activePages.each((index, item) =&gt; {</div><div class="line">            indexes.push($(item).data(<span class="stringliteral">&quot;page-index&quot;</span>));</div><div class="line">        });</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> indexes;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// 获取所有激活的页面下标, 返回格式：1,5-9,12</span></div><div class="line">    getAllActivePageIndex (exitIndexArray) {</div><div class="line">        let result = [];</div><div class="line">        let pageIndexs = exitIndexArray || [];</div><div class="line">        <span class="keyword">const</span> $activePages = this.$html.find(<span class="stringliteral">&#39;.fv__active&#39;</span>);</div><div class="line">        $activePages.each((index, target) =&gt; {</div><div class="line">            pageIndexs.push($(target).attr(<span class="stringliteral">&#39;data-page-index&#39;</span>));</div><div class="line">        });</div><div class="line">        <span class="comment">// 去重、排序</span></div><div class="line">        pageIndexs = Array.from(<span class="keyword">new</span> Set(pageIndexs)).sort((a, b) =&gt; a - b);</div><div class="line">        <span class="comment">// 下标数组[1,2,3,4,5,6,10,11]循环成[1-6,10,11]</span></div><div class="line">        pageIndexs.reduce(<span class="keyword">function</span> (a, b) {</div><div class="line">            <span class="keywordflow">if</span> (!a || b - a &gt; 1) {</div><div class="line">                result[result.length] = [+b + 1];</div><div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (b - a === 1) {</div><div class="line">                result[result.length - 1].push(+b + 1);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">return</span> b;</div><div class="line">        }, <span class="stringliteral">&#39;&#39;</span>);</div><div class="line">        let ret = result.map(<span class="keyword">function</span> (item) {</div><div class="line">            <span class="keywordflow">if</span> (item.length === 1) <span class="keywordflow">return</span> item[0];</div><div class="line">            <span class="keywordflow">return</span> item[0] + <span class="charliteral">&#39;-&#39;</span> + item[item.length - 1];</div><div class="line">        });</div><div class="line">        <span class="keywordflow">return</span> [result, ret];</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">get</span> selectedPageRanges() {</div><div class="line">        <span class="keyword">const</span> selectedPages = this.getSelectedPages();</div><div class="line">        <span class="keyword">const</span> isSelected = selectedPages.length !== 0;</div><div class="line">        <span class="keyword">const</span> currentPage =</div><div class="line">        this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>()</div><div class="line">            .pdfViewer.<a class="code" href="class_p_d_f_viewer.html#a6f6e9b9bc0c421f649317010b3faf00e">getPDFDocRender</a>()</div><div class="line">            .getCurrentPageIndex() + 1;</div><div class="line">        <span class="keyword">const</span> pages = isSelected</div><div class="line">        ? selectedPages.map(<a name="a28"></a><a class="code" href="group___viewer_constants.html#gga4943f6c282c30f1028dae0e95c72ce1eaf53802b05054e04b31e1448357e63355">page</a> =&gt; <a class="code" href="group___viewer_constants.html#gga4943f6c282c30f1028dae0e95c72ce1eaf53802b05054e04b31e1448357e63355">page</a> + 1)</div><div class="line">        : [currentPage];</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> {</div><div class="line">        ...__.business.range_.getPageRanges(pages, 1),</div><div class="line">        isSelected</div><div class="line">        };</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// 判断选中的页是否为连续页</span></div><div class="line">    checkContinuePage(ids) {</div><div class="line">        <span class="keywordflow">if</span>(!Array.isArray(ids)) {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span>(ids.length === 1) {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">for</span> (let i=0; i&lt;ids.length; i++) {</div><div class="line">            <span class="keywordflow">if</span>(i === ids.length - 1) {</div><div class="line">                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span>( ids[i] + 1 !== ids[i+1]) {</div><div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    addDragEvent () {</div><div class="line">        <span class="keyword">const</span> isCollaborationMode = this.pdfUI.customs &amp;&amp; this.pdfUI.customs.isCollaborationMode();</div><div class="line">        <span class="keywordflow">if</span> (isCollaborationMode || this.dragable) return ;</div><div class="line">        <span class="keyword">const</span> e1 = this.$html.find(<span class="stringliteral">&quot;.fv__thumb-image-container&quot;</span>)[0];</div><div class="line">        <span class="comment">// 拖动时末尾的占位框</span></div><div class="line">        let dragLastNode = document.createElement(<span class="stringliteral">&quot;div&quot;</span>);</div><div class="line">        dragLastNode.setAttribute(<span class="stringliteral">&quot;data-page-index&quot;</span>,<span class="stringliteral">&quot;-1&quot;</span>);</div><div class="line">        dragLastNode.style.borderStyle = <span class="stringliteral">&quot;dashed&quot;</span>;</div><div class="line">        </div><div class="line">        this.dragable = Dragable.create(e1, {</div><div class="line">            draggable: <span class="stringliteral">&quot;fv__thumb-page&quot;</span>,  <span class="comment">// 允许拖拽的节点类名</span></div><div class="line">            dragClass: <span class="stringliteral">&quot;draggable-drag&quot;</span>, <span class="comment">// 正在被拖拽中的css类名</span></div><div class="line">            chosenClass: <span class="stringliteral">&quot;thumb-sortable-ghost&quot;</span>,  <span class="comment">// 被选中项的css 类名</span></div><div class="line">            inventedNode: dragLastNode,</div><div class="line">            endStrict: <span class="keyword">false</span>,</div><div class="line">            dragOverStrict: <span class="keyword">true</span>,</div><div class="line">            checkIsMoveToRight: (target, info) =&gt; {</div><div class="line">                <span class="keyword">const</span> targetRect = target.getBoundingClientRect();</div><div class="line">                <span class="keyword">const</span> centerX = (targetRect.left + targetRect.right) * 0.5;</div><div class="line">                <span class="keywordflow">return</span> info.mouseX &gt; centerX;</div><div class="line">            },</div><div class="line">            <span class="comment">// 隐藏子菜单</span></div><div class="line">            onStart: (data) =&gt; {</div><div class="line">            <span class="keyword">const</span> dom = $(data.dom);</div><div class="line">            <span class="keywordflow">if</span>(!dom.hasClass(<span class="stringliteral">&quot;fv__active&quot;</span>)) {</div><div class="line">                this.$html.find(<span class="stringliteral">&quot;.fv__active&quot;</span>).removeClass(<span class="stringliteral">&quot;fv__active&quot;</span>);</div><div class="line">                dom.addClass(<span class="stringliteral">&quot;fv__active&quot;</span>);</div><div class="line">            }</div><div class="line">            },</div><div class="line">            <span class="comment">// 悬停打开子菜单</span></div><div class="line">            onHover: (data) =&gt; {</div><div class="line">            },</div><div class="line">            onDrop: (data) =&gt; {</div><div class="line">                <span class="keywordflow">if</span> (this.dragable.options.allowDrag) {</div><div class="line">                    <span class="keyword">const</span> dragFiles = data.dragFiles;</div><div class="line">                    <span class="comment">// 如果 dragFiles length &gt; 0则说明是文件拖入 insert</span></div><div class="line">                    <span class="keywordflow">if</span> (dragFiles.length === 0) {</div><div class="line">                        <span class="keywordflow">return</span>;</div><div class="line">                    }</div><div class="line">                    this.dragFileInsert(data);</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    this.dragable._removeClass(this.dragable.options.chosenClass, data.target);</div><div class="line">                }</div><div class="line">            },</div><div class="line">            onEnd: (data) =&gt; {</div><div class="line">                <span class="keywordflow">if</span>(!data || !data.end) {</div><div class="line">                    isTouchDevice &amp;&amp; data?.fromAttrs?.pageIndex &amp;&amp; (</div><div class="line">                        this.<a class="code" href="class_component.html#a3d216b2a16509d8b4285e324fa28ef81">getPDFUI</a>().goToPage(parseInt(data.fromAttrs.pageIndex, 10), 0, 0, <span class="keyword">false</span>)</div><div class="line">                    );</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keyword">const</span> $activePages = this.$html.find(<span class="stringliteral">&quot;.fv__active&quot;</span>);</div><div class="line">                let ids = [];</div><div class="line">                $activePages.each((index, item) =&gt; {</div><div class="line">                    ids.push($(item).data(<span class="stringliteral">&quot;page-index&quot;</span>));</div><div class="line">                });</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span>(ids.length &lt; 1) {</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                let toIndex = parseInt(data.endAttrs.pageIndex);</div><div class="line">                <span class="keywordflow">if</span> (data.isMoveToRight) toIndex++;</div><div class="line">                <span class="keyword">const</span> pageCnt = this.$pages.length;</div><div class="line">                <span class="keywordflow">if</span>(toIndex === -1) {</div><div class="line">                    toIndex = pageCnt;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span>((isMacOS &amp;&amp; data.end.altKey) || (!isMacOS &amp;&amp; data.end.ctrlKey)) { <span class="comment">// 复制</span></div><div class="line">                    this.copyPages(ids, toIndex);</div><div class="line">                } <span class="keywordflow">else</span> { <span class="comment">// 移动</span></div><div class="line">                    <span class="comment">// 以下是移动位置的限制</span></div><div class="line">                    <span class="keywordflow">if</span>(ids.length === 1) {</div><div class="line">                        <span class="keywordflow">if</span>(ids[0] === toIndex || ids[0] === toIndex - 1) {</div><div class="line">                            <span class="keywordflow">return</span>;</div><div class="line">                        }</div><div class="line">                    }<span class="keywordflow">else</span> {</div><div class="line">                        <span class="keywordflow">if</span>(this.checkContinuePage(ids)) {</div><div class="line">                            <span class="keywordflow">if</span>(ids.includes(toIndex) || ids[ids.length - 1] === toIndex - 1) {</div><div class="line">                                <span class="keywordflow">return</span>;</div><div class="line">                            }</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                    this.movePages(ids, toIndex);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        });</div><div class="line">        this.<a class="code" href="class_component.html#a980cf1c65fa4f6673b0bd81a5ff8788d">addDestroyHook</a>(() =&gt; {</div><div class="line">            this.removeDragEvent();</div><div class="line">        });</div><div class="line">    }</div><div class="line">    removeDragEvent () {</div><div class="line">        this.dragable &amp;&amp; this.dragable.destory();</div><div class="line">        this.dragable = null;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">const</span> isRectsOverlap = (src, dst) =&gt; {</div><div class="line">    let <a class="code" href="group___consts_p_d_f.html#ggacdfaca60ec19c0265bac2692d7982726ac9db6893f15f10cc1c29bf33d486fe05">left</a> = Math.max(src.left, dst.left);</div><div class="line">    let top = Math.max(src.top, dst.top);</div><div class="line">    let bottom = Math.min(src.bottom, dst.bottom);</div><div class="line">    let <a name="a29"></a><a class="code" href="group___consts_p_d_f.html#ggacdfaca60ec19c0265bac2692d7982726af763d610923b0c4614e8ecd65212666a">right</a> = Math.min(src.right, dst.right);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> right &gt;= left &amp;&amp; bottom &gt;= top;</div><div class="line">};</div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<html>
<body>
<hr class="footer" id="nav-path"/>
<p align="right">
	<center>
	<img class="footer" src="logo.png" alt="Foxit Software Corporation Logo"/>
	</center>
	<center>
	@2024 Foxit Software Incorporated. All rights reserved.
	</center>
</p>
<style>
	.server-only-jr {
		display:inline;
	}
	.server-only-sr,
	.not-support-in-server,
	.support-in-server {
		display: none;
	}
	a.vel:after {
		content: ' ';
		background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkNhcGFfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiCgkgdmlld0JveD0iMCAwIDI4My45MjIgMjgzLjkyMiIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjgzLjkyMiAyODMuOTIyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTI2Ni40MjIsMGgtOTcuNjI1Yy05LjY1LDAtMTcuNSw3Ljg1MS0xNy41LDE3LjVjMCw5LjY0OSw3Ljg1LDE3LjUsMTcuNSwxNy41aDU1LjM3N2wtOTIuMzc1LDkyLjM3NAoJCWMtMy4zMDcsMy4zMDUtNS4xMjcsNy42OTktNS4xMjcsMTIuMzc1YzAsNC42NzYsMS44MTksOS4wNjksNS4xMjUsMTIuMzcxYzMuMzA2LDMuMzA5LDcuNjk5LDUuMTMsMTIuMzc1LDUuMTMKCQljNC42NzQsMCw5LjA2OS0xLjgyLDEyLjM3Ni01LjEyN2w5Mi4zNzQtOTIuMzc1djU1LjM3N2MwLDkuNjQ5LDcuODUxLDE3LjUsMTcuNSwxNy41YzkuNjQ5LDAsMTcuNS03Ljg1MSwxNy41LTE3LjVWMTcuNQoJCUMyODMuOTIyLDcuODUxLDI3Ni4wNzEsMCwyNjYuNDIyLDB6IiBmaWxsPSIjM0Q1NzhDIi8+Cgk8cGF0aCBkPSJNMjAxLjEzNywyNTMuOTIySDMwVjgyLjc4NWgxMjguNzExbDMwLTMwSDE1Yy04LjI4NCwwLTE1LDYuNzE2LTE1LDE1djIwMS4xMzdjMCw4LjI4NCw2LjcxNiwxNSwxNSwxNWgyMDEuMTM3CgkJYzguMjg0LDAsMTUtNi43MTYsMTUtMTVWOTUuMjExbC0zMCwzMFYyNTMuOTIyeiIgIGZpbGw9IiMzRDU3OEMiLz4KPC9nPgo8L3N2Zz4K);
		display: inline-block;
		width: 12px;
		height: 12px;
		line-height: 0;
		vertical-align: baseline;
		margin: 0 2px;
		background-repeat: no-repeat;
		background-position: center;
	}
	.type-name {
	    font-weight: bold;
	    font-style: italic;
	    color: #354C7B;
	    padding-right: 1em;
	}
	.show-plain-text:before {
    	content: attr(text);
    }
    .optional-member {
        display: block;
        font: 400 14px/22px Roboto,sans-serif;
        margin: 1em 0;
    }
    .optional-member:before {
        content: 'Optional';
        font-weight: bold;
    }
    .mdescRight>.optional-member {
        display: none;
    }
</style>
<script>
var _eSRStyle;
function createSRStyle () {
	if (_eSRStyle) {
		return;
	}
	var eStyle = document.createElement('style');
	eStyle.innerHTML = '.server-only-jr{display:none;} .server-only-sr,.not-support-in-server,.support-in-server{display:inline;} ';
	document.body.appendChild(eStyle);
	_eStyle = eStyle;
}
function removeSRStyle () {
	try{
	document.body.removeChild(_eSRStyle);
	_eSRStyle = null;
	}catch(ex){}
}
function hasSRhash () {
	var _hash = location.hash.slice(1);
	if (_hash.indexOf('SR=true') !== -1) {
		return true;
	}
	return false;
}
if (hasSRhash()) {
	createSRStyle();
}
window.onhashchange = function () {
	if (hasSRhash()) {
    	createSRStyle();
    } else {
    	removeSRStyle();
    }
}
var paramDesc = document.querySelectorAll('.memitem .memdoc .params table.params tr>td:nth-child(2)')
console.log(paramDesc);
paramDesc.forEach(function(it) {
    var childNodes = it.childNodes;
    var textNode = childNodes[0];
    if(!(textNode instanceof Text)) {
        return;
    }
    var text = textNode.textContent.trim();
    if(text === '{') {
        const another = childNodes[2];
        if(!(another instanceof Text)) {
            return;
        }
        const i = another.textContent.trim().indexOf('}');
        if(i > -1) {
            textNode.remove();
            another.textContent = another.textContent.replace('}', '');
        }
        return;
    }
    var reg = /([\S]*)?[\s\-]+?([^\s-].+)$/;
    var result = reg.exec(text);
    if(result) {
        var type = result[1].replace(/(^\{)|(\}$)/g, '');
        var descText = result[2];
        var typeNode = document.createElement('span');
        typeNode.className = 'type-name';
        typeNode.innerText = type;
        var descNode = document.createTextNode(descText);
        textNode.after(typeNode, descNode);
        textNode.remove();
    }
//     const desc = it.innerHTML.trim();
//     var parts = it.innerText.trim().split(/\s*[\s\-]\s*/);
//     var type = parts[0];
//     var other = parts.slice(1).join(' ');
//     it.innerHTML = [
//         '<span class="type-name">', type, '</span>',
//         other
//     ].join('');
})
var linksInCodeFragment = document.querySelectorAll('.fragment a.code');
linksInCodeFragment.forEach(function(link) {
	link.replaceWith(link.innerText);
});
</script>
</BODY></HTML>