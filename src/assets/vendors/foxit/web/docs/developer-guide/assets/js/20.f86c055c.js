(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{310:function(t,s,a){t.exports=a.p+"assets/img/simple-request.ad7ef4a8.png"},311:function(t,s,a){t.exports=a.p+"assets/img/invalid-access-origin.9f9a4d6c.png"},312:function(t,s,a){t.exports=a.p+"assets/img/missing-allow-headers.aeedbc77.png"},451:function(t,s,a){"use strict";a.r(s);var e=a(14),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"cors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cors"}},[t._v("#")]),t._v(" CORS")]),t._v(" "),s("h2",{attrs:{id:"原理简析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#原理简析"}},[t._v("#")]),t._v(" 原理简析")]),t._v(" "),s("h3",{attrs:{id:"什么是-cors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是-cors"}},[t._v("#")]),t._v(" 什么是 CORS")]),t._v(" "),s("p",[t._v("CORS 是一个基于 HTTP 头的 "),s("a",{attrs:{href:"https://www.w3.org/TR/2020/SPSD-cors-20200602/",target:"_blank",rel:"noopener noreferrer"}},[t._v("W3C 标准机制"),s("OutboundLink")],1),t._v("，全称是“跨域资源共享”（Cross-origin resource sharing）。该机制通过额外的 HTTP 响应头来告诉浏览器一个页面是否允许访问来自不同源服务器上的资源，克服了 AJAX 只能使用同源的限制，从而实现跨域访问资源。")]),t._v(" "),s("p",[t._v("更详细的关于 CORS 的介绍，可以参考这篇"),s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN文档"),s("OutboundLink")],1),t._v("：")]),t._v(" "),s("h3",{attrs:{id:"同源策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#同源策略"}},[t._v("#")]),t._v(" 同源策略")]),t._v(" "),s("p",[t._v("同源策略是一种用于隔离潜在恶意文件、减少被攻击的重要安全机制，其限制了一个源的页面或者它加载的脚本如何能于另一个源的资源进行交互。举个例子，在一个页面中，通过 AJAX 向一个不同源的URL发送请求，浏览器检测到该请求不同源(也就跨域)，则阻止请求，并在控制台输出错误。")]),t._v(" "),s("p",[t._v("那什么是同源？用一句话说，具有相同的协议、IP/域名、端口就可以认为是同源，只要其中一项不同，则不是同源。下表给出了一些示例：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("URLs")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("结果")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("原因")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("http://www.company.com/")]),s("br"),s("code",[t._v("https://www.company.com/")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("不同源")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("协议不同")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("http://www.company.com/")]),s("br"),s("code",[t._v("http://www.company.net/")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("不同源")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("域名不同")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("http://www.company.com/")]),s("br"),s("code",[t._v("http://blob.company.com/")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("不同源")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("域名不同")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("http://www.company.com/")]),s("br"),s("code",[t._v("http://blob.company.com/")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("不同源")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("域名不同")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("http://www.company.com/")]),s("br"),s("code",[t._v("http://www.company.com:8080/")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("不同源")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("端口不同("),s("code",[t._v("http://")]),t._v(" 默认端口是 80)")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("http://www.company.com/")]),s("br"),s("code",[t._v("http://www.company.com/blob.html")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("同源")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("只有路径不同")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("http://www.company.com/blog/index.html")]),s("br"),s("code",[t._v("http://www.company.com/blob.html")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("同源")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("只有路径不同")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("http://192.168.0.1/")]),s("br"),s("code",[t._v("http://192.168.1.1")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("不同源")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("IP不同")])])])]),t._v(" "),s("h3",{attrs:{id:"两种-cors-请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#两种-cors-请求"}},[t._v("#")]),t._v(" 两种 CORS 请求")]),t._v(" "),s("p",[t._v("浏览器将 CORS 请求分成两类：简单请求和非简单请求。\n只要一个请求同时满足以下两大条件，就属于简单请求：")]),t._v(" "),s("blockquote",[s("p",[t._v("(1) 请求方法是这三种方法之一： HEAD, GET, POST\n(2) HTTP 的头部信息不超出以下几种字段：\n- Accept\n- Accept-Language\n- Content-Language\n- Last-Event-ID\n- Content-Type 为 application/x-www-form-urlencoded, multipart/form-data, text/plain 三者之一")])]),t._v(" "),s("p",[t._v("浏览器对这两种请求的处理是不一样的。")]),t._v(" "),s("h4",{attrs:{id:"简单请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简单请求"}},[t._v("#")]),t._v(" 简单请求")]),t._v(" "),s("p",[t._v("对于简单请求，浏览器直接发出 CORS 请求，并在请求头之中增加一个 "),s("code",[t._v("Origin")]),t._v(" 字段：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(310),alt:"simple-request"}})]),t._v(" "),s("p",[s("code",[t._v("Origin")]),t._v(" 字段说明了本次请求来自哪个源（协议、域名、端口）, 服务器端可以根据这个值来设置 Access-Control-Allow-Origin 字段，告诉浏览器是否响应这次请求。")]),t._v(" "),s("h4",{attrs:{id:"非简单请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#非简单请求"}},[t._v("#")]),t._v(" 非简单请求")]),t._v(" "),s("p",[t._v("非简单请求和简单请求不同，在浏览器检测到一个非简单请求时，会先自动发起一次 OPTIONS 请求，也就是预检（Preflight）请求，预检请求的作用就是询问服务器端是否允许跨域，这么做通常是为了避免额外的计算逻辑。当浏览器接收到预检请求的响应内容后，浏览器会判断响应头中的 "),s("code",[t._v("Access-Control-Allow-Origin")]),t._v(", "),s("code",[t._v("Access-Control-Allow-Methods")]),t._v(" 等相关字段来决定是否继续发送第二次请求。")]),t._v(" "),s("h3",{attrs:{id:"几个典型的跨域错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#几个典型的跨域错误"}},[t._v("#")]),t._v(" 几个典型的跨域错误")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("响应头没有包含 "),s("code",[t._v("Access-Control-Allow-Origin")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-log extra-class"},[s("pre",{pre:!0,attrs:{class:"language-log"}},[s("code",[t._v("Access to fetch at "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://127.0.0.1:8967/1.pdf'")]),t._v(" from origin "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://127.0.0.1:7001'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("has been blocked by CORS policy:")]),t._v("\nNo "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),t._v(" header is present on the requested resource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" \nIf an opaque response serves your needs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" set the request's mode to "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no-cors'")]),t._v(" to fetch the resource with CORS disabled"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("code",[t._v("Access-Control-Allow-Origin")]),t._v(" 格式错误：")]),t._v(" "),s("div",{staticClass:"language-log extra-class"},[s("pre",{pre:!0,attrs:{class:"language-log"}},[s("code",[t._v("Access to fetch at "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<AJAX请求目标源: 比如: http://192.168.0.1:8080>'")]),t._v(" from origin "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://127.0.0.1:7001'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("has been blocked by CORS policy:")]),t._v("\nThe "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),t._v(" header contains the invalid value "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<Access-Control-Allow-Origin 响应头内容>'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nHave the server send the header with a valid value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" or"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" if an opaque response serves your needs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \nset the request's mode to "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no-cors'")]),t._v(" to fetch the resource with CORS disabled"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:a(311),alt:"invalid access origin"}})])]),t._v(" "),s("li",[s("p",[s("code",[t._v("Access-Control-Allow-Origin")]),t._v(" 不匹配")]),t._v(" "),s("div",{staticClass:"language-log extra-class"},[s("pre",{pre:!0,attrs:{class:"language-log"}},[s("code",[t._v("Access to fetch at "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://127.0.0.1:8967/1.pdf'")]),t._v(" from origin "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://127.0.0.1:7001'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("has been blocked by CORS policy:")]),t._v(" Response to preflight request doesn't pass access control check"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" The "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),t._v(" header has a value "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<Access-Control-Allow-Origin 响应头内容, 比如：http://127.0.0.1:9999>'")]),t._v(" that is not equal to the supplied origin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" Have the server send the header with a valid value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" or"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" if an opaque response serves your needs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" set the request's mode to "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'no-cors'")]),t._v(" to fetch the resource with CORS disabled"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("code",[t._v("Access-Control-Allow-Headers")]),t._v(" 未设置")]),t._v(" "),s("div",{staticClass:"language-log extra-class"},[s("pre",{pre:!0,attrs:{class:"language-log"}},[s("code",[t._v("Access to fetch at "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://127.0.0.1:8967/1.pdf'")]),t._v(" from origin "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://127.0.0.1:7001'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("has been blocked by CORS policy:")]),t._v(" Request header field range is not allowed by Access"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Headers in preflight response\n")])])]),s("p",[s("img",{attrs:{src:a(312),alt:"missing-allow-headers"}})])])]),t._v(" "),s("h2",{attrs:{id:"cors-解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cors-解决方案"}},[t._v("#")]),t._v(" CORS 解决方案")]),t._v(" "),s("p",[t._v("解决 CORS 的方法有两种，一种是使用代理服务器避免出现跨域， 另一种则是配置 CORS 规则")]),t._v(" "),s("h3",{attrs:{id:"使用代理服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用代理服务器"}},[t._v("#")]),t._v(" 使用代理服务器")]),t._v(" "),s("p",[t._v("代理服务器是一个位于客户端和目标服务器之间的中间服务器，我们可以通过代理服务器来请求第三方URL资源，由于请求是代理服务器发起的，因此浏览器不会出现CORS问题。我们可以自己搭建一个代理服务器，也可以使用第三方提供的代理服务器。这里介绍 nginx 和 nodejs 配置代理服务器的方法，这些方法都是实现同一个功能，就是将 "),s("code",[t._v("/prefix/*")]),t._v("的请求代理到第三方服务服务器 "),s("code",[t._v("http://third_party.file.server")]),t._v(" 上， 同时去掉原始路径中的 "),s("code",[t._v("/prefix")]),t._v(" 前缀。如 "),s("code",[t._v("http://location:3000/prefix/path/to/some.pdf")]),t._v(" 请求代理后的 URL 为 "),s("code",[t._v("http://third_party.file.server/path/to/some.pdf")]),t._v("。")]),t._v(" "),s("h4",{attrs:{id:"nginx-配置代理服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置代理服务器"}},[t._v("#")]),t._v(" Nginx 配置代理服务器")]),t._v(" "),s("p",[t._v("Nginx 是一个高性能的 Web 服务器，也可以作为代理服务器使用，下面是 Nginx 中配置代理服务器的方法：")]),t._v(" "),s("p",[t._v("打开 nginx 配置文件，(通常位于/etc/nginx/nginx.conf, 具体情况视服务器环境决定), 找到对应的 server 块，并添加一下代码：")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~* ^/prefix/(.*)")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://third_party.file.server/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$is_args")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$args")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_redirect")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("上述代码指示 Nginx 在接收到路径中以 /prefix 开头的请求时，先拼凑出正确的文件URL路径，再把请求代理到第三方文件服务器上。")]),t._v(" "),s("h4",{attrs:{id:"nodejs-配置代理服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nodejs-配置代理服务器"}},[t._v("#")]),t._v(" Nodejs 配置代理服务器")]),t._v(" "),s("p",[t._v("以 Express, Koa, NestJS 为例")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Express")]),t._v(" "),s("p",[t._v("Express 可以搭配 http-proxy-middleware 这个第三方中间件实现代理，配合 express 的路由功能，将以 prefix 开头的请求代理到第三方文件服务器上：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" express "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" createProxyMiddleware "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http-proxy-middleware'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/prefix'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createProxyMiddleware")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("target")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://third_party.file.server'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("changeOrigin")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("pathRewrite")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^/prefix'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("这段代码在接收到路径以 /prefix 开头的请求时，会帮我们将路径中的 /prefix/ 替换掉， 并将请求转发到 target URL 去。更多用法可以参考 "),s("a",{attrs:{href:"https://www.npmjs.com/package/http-proxy-middleware",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.npmjs.com/package/http-proxy-middleware"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[t._v("Koa")]),t._v(" "),s("p",[t._v("Koa 需要搭配 koa-proxy 这个第三方中间实现代理：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Koa "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" proxy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-proxy'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Koa")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("proxy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/prefix'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://third_party.file.server'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("^\\/prefix\\/")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/prefix'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 替换掉路径中的 /prefix 前缀")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("更多用法可以参考 "),s("a",{attrs:{href:"https://www.npmjs.com/package/koa-proxy",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.npmjs.com/package/koa-proxy"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[t._v("NestJS\n和 express 类似，也可以搭配 "),s("code",[t._v("http-proxy-middleware")]),t._v(" 这个第三方库实现代理：")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" NestFactory "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@nestjs/core'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" AppModule "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./app.module'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" createProxyMiddleware "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http-proxy-middleware'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bootstrap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" NestFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("AppModule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Proxy endpoints")]),t._v("\n    app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/prefix'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createProxyMiddleware")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        target"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://third_party.file.server'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        changeOrigin"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        pathRewrite"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("^/prefix")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bootstrap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("这段代码最终效果和 Express 的示例相同。")])])]),t._v(" "),s("h3",{attrs:{id:"配置-cors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-cors"}},[t._v("#")]),t._v(" 配置 CORS")]),t._v(" "),s("p",[t._v("WebSDK 中最经常能够遇到跨域问题的接口就是 PDFViewer.openPDFByHttpRangeRequest , 为了提高PDF文档打开速度和减少文件服务器带宽，这个接口会在发送 PDF 文件请求时向文件服务器发送带有 "),s("code",[t._v("Range")]),t._v(" 请求头的请求，并且在接收到响应后，需要根据"),s("code",[t._v("Content-Range")]),t._v("响应头计算文件总大小。所以在配置 CORS 时，应至少包含以下三项：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("Access-Control-Allow-Headers: Range"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nAccess-Control-Allow-Origin: *"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" // 为了安全考虑，建议和请求头中的 Referer 的值相同\nAccess-Control-Expose-Headers: Content-Range"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" // 只有将加入这里的响应头 key，才能被 JS 获取到响应头的值。\n")])])]),s("p",[t._v("下面将列举出几个不同场景下的配置方法。")]),t._v(" "),s("h4",{attrs:{id:"web-服务器配置-cors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#web-服务器配置-cors"}},[t._v("#")]),t._v(" Web 服务器配置 CORS")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Nginx 配置 CORS")]),t._v(" "),s("p",[t._v("在 nginx.conf（一般目录是 "),s("code",[t._v("/etc/nginx/nginx.conf")]),t._v("） 文件中添加下面的节点：")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8967")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" 127.0.0.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("charset")]),t._v(" utf8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/files/directory/"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ("),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_method")]),t._v(" = OPTIONS)")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Headers'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Range'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Expose-Headers'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Range'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("204")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Headers'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Range'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Expose-Headers'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Range'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("上面的配置允许了所有站点都可以跨域访问资源，这是一种非常不安全但省事的做法，实际的应用场景应添加限制，比如根据访问的源设置是否允许跨域，做法如下：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("添加 $cors 变量，根据 $http_origin 判断是否为合法的源, 下面的代码将允许所有 foxit.com 的子域名跨域访问资源：")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_origin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cors")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    '~*^https?://.*.foxit.com$' 'true'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("添加 $allow_origin 变量，如果 $cors 值为 'true', 则表示该请求为跨域访问，则响应 "),s("code",[t._v("Access-Control-Allow-Origin")]),t._v(" 值")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cors")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$allow_origin")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    'true' $http_origin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("如此，也可以想上一步那样，在跨域访问时再指定 "),s("code",[t._v("Access-Control-Allow-Headers")]),t._v(" 响应头")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cors")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$allow_headers")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    'true' 'Range'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("最后我们整合所有配置")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_origin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cors")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    '~*^https?://.+.foxit.com$' 'true'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cors")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$allow_origin")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    'true' $http_origin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cors")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$allow_headers")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    'true' 'Range'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$cors")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$allow_expose_headers")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    'true' 'Content-Range'\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8967")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" 127.0.0.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("charset")]),t._v(" utf8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path/to/files/directory/"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ("),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_method")]),t._v(" = OPTIONS)")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Headers'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$allow_headers")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$allow_origin")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Expose-Headers'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$allow_expose_headers")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("204")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Headers'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$allow_headers")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$allow_origin")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Expose-Headers'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$allow_expose_headers")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),s("p",[t._v("为了确保修改是正确的，我们建议先运行 "),s("code",[t._v("nginx -t")]),t._v(" 检查配置变化是否有误，如果无误，再运行 "),s("code",[t._v("nginx -s reload")]),t._v(" 重新加载 nginx 服务.")])]),t._v(" "),s("li",[s("p",[t._v("Tomcat 配置 CORS\n下面是一个精简的 CORS 配置例子， 当然，你也可以参考 Tomcat 官方文档： "),s("a",{attrs:{href:"http://tomcat.apache.org/tomcat-7.0-doc/config/filter.html#CORS_Filter",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://tomcat.apache.org/tomcat-7.0-doc/config/filter.html#CORS_Filter"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("filter-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("CorsFilter"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("filter-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("filter-class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.apache.catalina.filters.CorsFilter"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("filter-class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("init-param")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("cors.allowed.origins"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param-value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("https://*.foxit.org"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param-value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("init-param")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("init-param")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("cors.allowed.headers"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param-value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Range"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param-value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("init-param")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("init-param")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("cors.exposed.headers"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("param-value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Content-Range"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("param-value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("init-param")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("filter-mapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("filter-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("CorsFilter"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("filter-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("url-pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("/*"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("url-pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("filter-mapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Apache 配置 CORS\n在 Apache 中， 我们可以通过添加以下规则到服务器配置（通常位于 httpd.conf 或 apache.conf）的"),s("code",[t._v("<Directory>")]),t._v(","),s("code",[t._v("<Location>")]),t._v(", "),s("code",[t._v("<Files>")]),t._v("或"),s("code",[t._v("<VirtualHost>")]),t._v("部分中来启用 CORS,:")]),t._v(" "),s("div",{staticClass:"language-conf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Header set Access-Control-Allow-Origin '*';\nHeader set Access-Control-Allow-Headers 'Range';\nHeader set Access-Control-Expose-Headers 'Content-Range';\n")])])]),s("p",[t._v("也可以在 .htaccess 文件中添加下面的代码：")]),t._v(" "),s("div",{staticClass:"language-conf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("<IfModule mod_headers.c>\n    Header set Access-Control-Allow-Origin '*';\n    Header set Access-Control-Allow-Headers 'Range';\n    Header set Access-Control-Expose-Headers 'Content-Range';\n</IfModule>\n")])])]),s("p",[t._v("为了确保修改是正确的，强烈建议你使用 "),s("code",[t._v("apachectl -t")]),t._v(" 来检查配置变化是否有误，检查无误之后在运行 "),s("code",[t._v("sudo service apache2.conf")]),t._v(" 或 "),s("code",[t._v("apachectl -k graceful")]),t._v(" 来重新加载 Apache 服务。\n注意：你也可以使用 "),s("code",[t._v("add")]),t._v(" 代替 "),s("code",[t._v("set")]),t._v(" 命令,但是 add 可能会导致头信息被多次添加，所以最安全的做法就是用 "),s("code",[t._v("set")]),t._v(".")])]),t._v(" "),s("li",[s("p",[t._v("IIS 配置 CORS\nIIS6 和 IIS7 版本配置方式有所不同，在配置前请先确认当前使用的版本。")]),t._v(" "),s("ol",[s("li",[t._v("IIS6\n打开 IIS, 选择你需要配置的站点，右键进入属性对话框，选择 'HTTP 头'标签，点击 添加 按钮，然后分别添加这些响应头： "),s("code",[t._v("Access-Control-Allow-Headers: 'Range'")]),t._v(";"),s("code",[t._v("Access-Control-Allow-Origin: *")]),t._v(";"),s("code",[t._v("Access-Control-Expose-Headers: Content-Range")]),t._v(";")]),t._v(" "),s("li",[t._v("IIS7\n将下面的配置合并或添加到你的站点配置（也就是 web.config 配置文件，如果没有的话可以新建一个）中：")])]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token prolog"}},[t._v('<?xml version="1.0" encoding="utf-8"?>')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("system.webServer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("httpProtocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("customHeaders")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Access-Control-Allow-Origin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Access-Control-Allow-Headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Range"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Access-Control-Expose-Headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Content-Range"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("customHeaders")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("httpProtocol")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("system.webServer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])])]),t._v(" "),s("h4",{attrs:{id:"云存储资源配置-cors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#云存储资源配置-cors"}},[t._v("#")]),t._v(" 云存储资源配置 CORS")]),t._v(" "),s("p",[t._v("市场上有很多云存储和CDN服务，大部分通过查阅官方文档都可以找到响应的配置方式， 这里只列举几个例子：")]),t._v(" "),s("ol",[s("li",[t._v("Alibaba Cloud: "),s("a",{attrs:{href:"https://www.alibabacloud.com/help/en/object-storage-service/latest/configure-cors",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.alibabacloud.com/help/en/object-storage-service/latest/configure-cors"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("Tencent Cloud: "),s("a",{attrs:{href:"https://www.tencentcloud.com/document/product/436/13318",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.tencentcloud.com/document/product/436/13318"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("Google Cloud: "),s("a",{attrs:{href:"https://cloud.google.com/storage/docs/using-cors",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://cloud.google.com/storage/docs/using-cors"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("Azure Storage: "),s("a",{attrs:{href:"https://learn.microsoft.com/en-us/rest/api/storageservices/cross-origin-resource-sharing--cors--support-for-the-azure-storage-services",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://learn.microsoft.com/en-us/rest/api/storageservices/cross-origin-resource-sharing--cors--support-for-the-azure-storage-services"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("AWS S3: "),s("a",{attrs:{href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/cors.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.aws.amazon.com/AmazonS3/latest/userguide/cors.html"),s("OutboundLink")],1)])]),t._v(" "),s("h4",{attrs:{id:"在服务端框架中配置-cors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在服务端框架中配置-cors"}},[t._v("#")]),t._v(" 在服务端框架中配置 CORS")]),t._v(" "),s("ol",[s("li",[t._v("Nodejs 相关框架\n"),s("ol",[s("li",[t._v("Express: 请参考 "),s("a",{attrs:{href:"https://expressjs.com/en/resources/middleware/cors.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("express cors middleware"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("Koa: 请参考 "),s("a",{attrs:{href:"https://github.com/koajs/cors",target:"_blank",rel:"noopener noreferrer"}},[t._v("@koa/cors"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("NestJS: 请参考 "),s("a",{attrs:{href:"https://docs.nestjs.com/security/cors",target:"_blank",rel:"noopener noreferrer"}},[t._v("CORS|NestJS"),s("OutboundLink")],1)])])]),t._v(" "),s("li",[t._v("SpringBoot (java) 框架请参考： "),s("a",{attrs:{href:"https://spring.io/guides/gs/rest-service-cors/#_enabling_cors",target:"_blank",rel:"noopener noreferrer"}},[t._v("Enabling Cross Origin Requests for a RESTful Web Service"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("Django (python) 请参考 "),s("a",{attrs:{href:"https://pypi.org/project/django-cors-headers/",target:"_blank",rel:"noopener noreferrer"}},[t._v("django-cors-headers"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("Laravel (php) 请参考 "),s("a",{attrs:{href:"https://github.com/fruitcake/laravel-cors",target:"_blank",rel:"noopener noreferrer"}},[t._v("laravel-cors"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);