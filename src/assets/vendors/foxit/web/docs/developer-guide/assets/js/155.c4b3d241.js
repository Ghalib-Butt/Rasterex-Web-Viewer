(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{450:function(e,r,s){"use strict";s.r(r);var t=s(14),a=Object(t.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"整合-serviceworker"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#整合-serviceworker"}},[e._v("#")]),e._v(" 整合 ServiceWorker")]),e._v(" "),r("h2",{attrs:{id:"文档目的"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#文档目的"}},[e._v("#")]),e._v(" 文档目的")]),e._v(" "),r("p",[e._v("本文档旨在为开发者提供一个全面的指南，帮助开发者在应用层集成和合并 SDK 内建的 ServiceWorker 功能。并解决 ServiceWorker 冲突问题和常见问题。")]),e._v(" "),r("p",[e._v("虽然浏览器允许在同一个域中注册多个 service worker, 但是这些 service worker 必须拥有不同的作用域 (scope), 这样，每个 Servie Worker 才可以独立控制不同作用域下的资源。而 MessageWorker.js 占用了一个作用域（默认为 '/'）, 就会导致应用层的 Service Worker 无法在相同的作用域下注册成功。所以应用层的 Service Worker 需要与SDK内置的 MessageWorker.js 共享同一个作用域时，就必须其合并为同一个文件。")]),e._v(" "),r("p",[e._v("本文档将介绍如何合并和自定义 Service Worker 相关的参数配置。")]),e._v(" "),r("h2",{attrs:{id:"serviceworker-简介"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#serviceworker-简介"}},[e._v("#")]),e._v(" ServiceWorker 简介")]),e._v(" "),r("p",[e._v("Service Worker 是一个运行在浏览器后台的脚本，可以用来实现离线功能、推送通知、后台同步等功能。它在网页加载完毕后，在后台运行，并可以拦截网络请求、缓存资源，并提供其他功能。")]),e._v(" "),r("p",[r("strong",[e._v("ServiceWorker 的主要功能：")])]),e._v(" "),r("ul",[r("li",[r("strong",[e._v("离线功能")]),e._v(": ServiceWorker 可以缓存资源，即使在网络断开的情况下，用户也能访问网站。")]),e._v(" "),r("li",[r("strong",[e._v("推送通知")]),e._v(": ServiceWorker 可以接收来自服务器的推送通知，并向用户展示消息。")]),e._v(" "),r("li",[r("strong",[e._v("后台同步")]),e._v(": ServiceWorker 可以在后台执行任务，例如上传数据或更新数据。")]),e._v(" "),r("li",[r("strong",[e._v("网络拦截")]),e._v(": ServiceWorker 可以拦截网络请求，并根据需要进行处理，例如缓存数据、修改请求头等。")])]),e._v(" "),r("h2",{attrs:{id:"messageworker-js-概述"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#messageworker-js-概述"}},[e._v("#")]),e._v(" MessageWorker.js 概述")]),e._v(" "),r("p",[e._v("MessageWorker.js 是 SDK 提供的，用于实现 Web Worker 层同步通信的 Service Worker 脚本。由于 MessageWorker.js 占用了独立的作用域，当应用层的 Service Worker 需要与其使用同一个作用域时，就需要将两者合并为同一个文件。")]),e._v(" "),r("h2",{attrs:{id:"环境准备"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[e._v("#")]),e._v(" 环境准备")]),e._v(" "),r("p",[e._v("在开始集成 Service Worker 之前，请确保你的开发环境以满足以下要求：")]),e._v(" "),r("ul",[r("li",[e._v("支持 Service Worker 的浏览器： 确保你的目标浏览器支持 Service Worker, 例如： Chrome, Firefox, Edge, 具体可参考 "),r("a",{attrs:{href:"https://caniuse.com/serviceworkers",target:"_blank",rel:"noopener noreferrer"}},[e._v("Can I use"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("code",[e._v("@foxitsoftware/foxit-pdf-sdk-for-web-library")]),e._v(": 必须是 "),r("code",[e._v("10.0.0")]),e._v(" 及以上的版本，并且 "),r("code",[e._v("lib")]),e._v(" 目录下包含 "),r("code",[e._v("MessageWorker.js")]),e._v(" 文件。")]),e._v(" "),r("li",[e._v("HTTPS 支持：您的网站必须通过 HTTPS 访问才能使用 Service Worker， 当然，开发环境例外， "),r("code",[e._v("localhost")]),e._v(" 和 "),r("code",[e._v("127.0.0.1")]),e._v(" 不需要开启 HTTPS 访问也能使用 Service Worker。")])]),e._v(" "),r("h2",{attrs:{id:"service-worker-注册和配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#service-worker-注册和配置"}},[e._v("#")]),e._v(" Service Worker 注册和配置")]),e._v(" "),r("p",[e._v("从 "),r("code",[e._v("10.0.0")]),e._v(" 开始， "),r("code",[e._v("PDFViewer")]),e._v(" 构造参数中新增了 "),r("a",{attrs:{href:"" + location.origin + "/docs/API_Reference/html/"+"/class_p_d_f_viewer.html",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("messageSyncServiceWorker")]),r("OutboundLink")],1),e._v(" 参数， 用于指定 Service Worker 的注册方式。")]),e._v(" "),r("p",[r("code",[e._v("messageSyncServiceWorker")]),e._v(" 有两种用法：")]),e._v(" "),r("ol",[r("li",[r("p",[e._v("方法一：指定 "),r("code",[e._v("url")]),e._v(" 和 "),r("code",[e._v("options")]),e._v(":")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("url")]),e._v(" 为 Service Worker 的注册路径；")]),e._v(" "),r("li",[r("code",[e._v("options")]),e._v(" 为 Service Worker 的注册选项, 可以参考 "),r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer/register#options",target:"_blank",rel:"noopener noreferrer"}},[e._v("MDN"),r("OutboundLink")],1),e._v(" 中的具体描述。")])]),e._v(" "),r("div",{staticClass:"language-js extra-class"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" viewer "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("PDFViewer")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("messageSyncServiceWorker")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("url")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/your-service-worker.js'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("options")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 可选")]),e._v("\n            "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("scope")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/'")]),e._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ... 其它参数")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])])]),e._v(" "),r("li",[r("p",[e._v("方法二：指定 "),r("code",[e._v("registriation")]),e._v(":")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("registration")]),e._v(" 为 "),r("code",[e._v("navigator.serviceWorker.register()")]),e._v(" 方法返回的 "),r("code",[e._v("Promise<ServiceWorkerRegistration>")]),e._v(" 对象。")])]),e._v(" "),r("div",{staticClass:"language-js extra-class"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" viewer "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("PDFViewer")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("messageSyncServiceWorker")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("registration")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" navigator"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("serviceWorker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[e._v("register")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/your-service-worker.js'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n            "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("scope")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/'")]),e._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ... 其它参数")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])])])]),e._v(" "),r("p",[e._v("方法一将由 SDK 内部决定何时注册 ServiceWorker。如果需要手动控制 ServiceWorker 的注册，必须使用方法二。")]),e._v(" "),r("p",[e._v("在SDK发布包中，我们提供了一个完整的示例（"),r("code",[e._v("/examples/PDFViewCtrl/integrate-service-worker")]),e._v("），您可以直接参考它的实现以及按照 README.md 文档运行和查看效果。")]),e._v(" "),r("h2",{attrs:{id:"service-worker-allowed-响应头"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#service-worker-allowed-响应头"}},[e._v("#")]),e._v(" "),r("code",[e._v("Service-Worker-Allowed")]),e._v(" 响应头")]),e._v(" "),r("p",[e._v("在默认情况下，Service Worker 允许的最大作用范围是由其脚本位置决定的。具体来说，Service Worker 的作用范围只能覆盖其脚本所在的目录及其子目录。例如，如果 Service Worker 脚本位于 "),r("code",[e._v("https://example.com/sub/worker.js")]),e._v("，那么它默认只能控制 "),r("code",[e._v("https://example.com/sub/")]),e._v(" 及其子路径下的资源， 如果将 "),r("code",[e._v("scope")]),e._v(" 参数强行指定为更大作用范围，则会导致 Service Worker 注册失败，并且报错: "),r("code",[e._v("The path of the provided scope ('/') is not under the max scope allowed ('/foxit-lib/')")]),e._v("。\n然而，在某些情况下，您可能希望扩大 Service Worker 的作用范围，以便它能够控制更大范围内的资源。这时候，Service-Worker-Allowed 响应头就显得尤为重要。通过配置这个响应头，您可以指定一个更广泛的路径，使得 Service Worker 可以在更大的范围内生效。")]),e._v(" "),r("h3",{attrs:{id:"配置-service-worker-allowed-响应头"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#配置-service-worker-allowed-响应头"}},[e._v("#")]),e._v(" 配置 "),r("code",[e._v("Service-Worker-Allowed")]),e._v(" 响应头")]),e._v(" "),r("p",[e._v("要使用 "),r("code",[e._v("Service-Worker-Allowed")]),e._v(" 响应头，您需要在 Service Worker 脚本的 HTTP 响应头中添加该字段。其值为允许的最大作用范围路径：")]),e._v(" "),r("div",{staticClass:"language-http extra-class"},[r("pre",{pre:!0,attrs:{class:"language-http"}},[r("code",[e._v("Service-Worker-Allowed /;\n")])])]),r("h4",{attrs:{id:"nginx-配置示例"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置示例"}},[e._v("#")]),e._v(" Nginx 配置示例")]),e._v(" "),r("p",[e._v("如果您使用 Nginx 作为服务器，可以通过修改 Nginx 配置文件来添加 Service-Worker-Allowed 响应头。以下是一个示例配置：")]),e._v(" "),r("div",{staticClass:"language-nginx extra-class"},[r("pre",{pre:!0,attrs:{class:"language-nginx"}},[r("code",[r("span",{pre:!0,attrs:{class:"token directive"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("server")])]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token directive"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("location")]),e._v(" /sw.js")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),r("span",{pre:!0,attrs:{class:"token directive"}},[r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("add_header")]),e._v(" Service-Worker-Allowed /")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),r("h4",{attrs:{id:"webpack-dev-server-配置示例"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#webpack-dev-server-配置示例"}},[e._v("#")]),e._v(" Webpack Dev Server 配置示例")]),e._v(" "),r("p",[e._v("如果您使用 Webpack Dev Server 进行本地开发，可以通过配置 devServer 添加 Service-Worker-Allowed 响应头。以下是一个配置示例：")]),e._v(" "),r("div",{staticClass:"language-js extra-class"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// webpack.config.js")]),e._v("\nmodule"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 其他配置")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("devServer")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("headers")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n            "),r("span",{pre:!0,attrs:{class:"token string-property property"}},[e._v("'Service-Worker-Allowed'")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/'")]),e._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),r("h4",{attrs:{id:"vue-config-js-配置示例"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#vue-config-js-配置示例"}},[e._v("#")]),e._v(" vue.config.js 配置示例")]),e._v(" "),r("p",[e._v("如果您使用 Vue CLI，可以通过修改 vue.config.js 来调整 Webpack Dev Server。以下是一个配置示例：")]),e._v(" "),r("div",{staticClass:"language-js extra-class"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// vue.config.js")]),e._v("\nmodule"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("devServer")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),r("span",{pre:!0,attrs:{class:"token literal-property property"}},[e._v("headers")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n            "),r("span",{pre:!0,attrs:{class:"token string-property property"}},[e._v("'Service-Worker-Allowed'")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/'")]),e._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),r("h2",{attrs:{id:"特殊的请求地址"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#特殊的请求地址"}},[e._v("#")]),e._v(" 特殊的请求地址")]),e._v(" "),r("p",[e._v("在应用层 Service Worker 监听的 "),r("code",[e._v("fetch")]),e._v(" 事件中，如果请求地址匹配到 "),r("code",[e._v("__foxitwebsdk-syncmsg__")]),e._v(", 请直接忽略该请求。这点在示例代码（"),r("code",[e._v("examples/PDFViewCtrl/integrate-service-worker/src/service-worker.js")]),e._v("）中，我们也有说明。")]),e._v(" "),r("h2",{attrs:{id:"常见问题和故障排查"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#常见问题和故障排查"}},[e._v("#")]),e._v(" 常见问题和故障排查")]),e._v(" "),r("ol",[r("li",[r("p",[e._v("ServiceWorker 未注册")]),e._v(" "),r("ul",[r("li",[e._v("问题描述：开发者工具中找不到 ServiceWorker 注册结果")]),e._v(" "),r("li",[e._v("可能原因：\n"),r("ol",[r("li",[e._v("路径设置不正确， Service Worker js 请求返回 404 或其它错误；")]),e._v(" "),r("li",[e._v("浏览器不支持；")]),e._v(" "),r("li",[e._v("未启用 HTTPS 协议，为了安全，Service Worker 只能在 HTTPS 协议下使用, 例外情况是 localhost 和 127.0.0.1 不需要 https；")])])]),e._v(" "),r("li",[e._v("解决方法：\n"),r("ol",[r("li",[e._v("检查 Service Worker 的注册代码和路径设置；")]),e._v(" "),r("li",[e._v("检查浏览器兼容性， Service Worker 兼容性请参考 "),r("a",{attrs:{href:"https://caniuse.com/serviceworkers",target:"_blank",rel:"noopener noreferrer"}},[e._v("Can I use"),r("OutboundLink")],1),e._v("；")]),e._v(" "),r("li",[e._v("开启 HTTPS 协议。")])])])])]),e._v(" "),r("li",[r("p",[e._v("ServiceWorker 注册失败")]),e._v(" "),r("ul",[r("li",[e._v("问题描述：注册时提示作用域超出最大允许范围。\n错误信息示例：")])]),e._v(" "),r("div",{staticClass:"language-log extra-class"},[r("pre",{pre:!0,attrs:{class:"language-log"}},[r("code",[e._v("    register a ServiceWorker for scope "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'http://localhost:9899/'")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(")")]),e._v(" with script "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'http://localhost:9899/lib/MessageWorker.js?b=http://localhost:9899/__foxitwebsdk-syncmsg__'")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(")")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" The path of the provided scope "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/'")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(")")]),e._v(" is not under the max scope allowed "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/foxit-lib/'")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v(" Adjust the scope"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" move the Service Worker script"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" or use the Service"),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Worker"),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("-")]),e._v("Allowed HTTP header to allow the scope"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("\n")])])]),r("ul",[r("li",[e._v("可能原因：Service Worker的注册路径或作用域设置不正确；要注意， Service Worker 允许的最大作用范围取决于 Service Worker 脚本本身的位置（参考: "),r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers#why_is_my_service_worker_failing_to_register",target:"_blank",rel:"noopener noreferrer"}},[e._v("MDN"),r("OutboundLink")],1),e._v("）。")]),e._v(" "),r("li",[e._v("解决方法：\n"),r("ol",[r("li",[e._v("理解 Service Worker 的作用域规则；")]),e._v(" "),r("li",[e._v("检查 Service Worker 的注册代码和作用域设置；")]),e._v(" "),r("li",[e._v("调整 Service Worker 的作用域, 也就是修改 "),r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer/register#scope",target:"_blank",rel:"noopener noreferrer"}},[e._v("scope"),r("OutboundLink")],1),e._v(" 参数；")]),e._v(" "),r("li",[e._v("调整 "),r("code",[e._v("Service-Worker-Allowed")]),e._v(" HTTP 响应头来允许更大的作用域；")]),e._v(" "),r("li",[e._v("检查 Service Worker 脚本的路径和服务器配置。")])])])])]),e._v(" "),r("li",[r("p",[e._v("ServiceWorker 注册提示 MIME 不支持")]),e._v(" "),r("ul",[r("li",[e._v("问题描述： 注册时提示 unsupported MIME type ('***/***')。\n错误信息示例：")])]),e._v(" "),r("div",{staticClass:"language-log extra-class"},[r("pre",{pre:!0,attrs:{class:"language-log"}},[r("code",[e._v("Failed to register a ServiceWorker for scope "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'http://localhost:5173/assets/'")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(")")]),e._v(" with script "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'http://localhost:5173/assets/service-worker.js'")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(")")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" The script has an unsupported MIME type "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[e._v("'text/html'")]),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("\n")])])]),r("ul",[r("li",[e._v("可能原因： ServiceWorker 的注册路径错误或目标文件不存在。")]),e._v(" "),r("li",[e._v("解决方法：\n"),r("ol",[r("li",[e._v("检查 ServiceWorker 的注册路径；")]),e._v(" "),r("li",[e._v("检查目标文件是否存在；")]),e._v(" "),r("li",[e._v("检查服务器配置。")])])])])])])])}),[],!1,null,null,null);r.default=a.exports}}]);